<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>uwkit&#39;site</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://yoursite.com/"/>
  <updated>2018-06-08T16:55:00.000Z</updated>
  <id>http://yoursite.com/</id>
  
  <author>
    <name>WaiKitHsu</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>NSTimer</title>
    <link href="http://yoursite.com/2018/06/09/NSTimer/"/>
    <id>http://yoursite.com/2018/06/09/NSTimer/</id>
    <published>2018-06-08T16:21:39.000Z</published>
    <updated>2018-06-08T16:55:00.000Z</updated>
    
    <content type="html"><![CDATA[<h6 id="NSTimer-å®šæ—¶å™¨"><a href="#NSTimer-å®šæ—¶å™¨" class="headerlink" title="NSTimer å®šæ—¶å™¨"></a>NSTimer å®šæ—¶å™¨</h6><p>åœ¨å›ºå®šçš„æ—¶é—´é—´éš”è¢«è§¦å‘ï¼Œè¢«è§¦å‘åç»™æŒ‡å®šçš„ç›®æ ‡å‘æ¶ˆæ¯æˆ–è€…æ‰§è¡Œä»£ç å—ä¸­å†…å®¹ã€‚<br>ä½¿ç”¨æ­¥éª¤ä¸€èˆ¬æ˜¯åˆ›å»ºåæ·»åŠ åˆ° runloopï¼Œ scheduledTimerWith å¼€å¤´çš„åˆ›å»ºæ–¹æ³•é»˜è®¤å°†å…¶æ·»åŠ åˆ°å½“å‰çš„ runloop ä¸­ã€‚timer å¿…é¡»è¢«æ·»åŠ åˆ° runloop ä¸­æ‰æœ‰æ•ˆï¼Œæ‰€ä»¥éœ€è¦ä¿è¯ runloop æ˜¯æœ‰è¿è¡Œçš„ã€‚ï¼ˆrunloop ä¸çº¿ç¨‹æ˜¯ä¸€ä¸€å¯¹åº”çš„ï¼Œä¸»çº¿ç¨‹çš„ runloop ä¼šåœ¨ app è¿è¡Œæ—¶è‡ªåŠ¨è¿è¡Œï¼Œè€Œå­çº¿ç¨‹åˆ™éœ€è¦æ‰‹åŠ¨è·å–è¿è¡Œï¼Œåœ¨ç¬¬ä¸€æ¬¡è·å–æ—¶æ‰ä¼šè¢«åˆ›å»ºå‡ºæ¥ã€‚ï¼‰</p><h6 id="éƒ¨åˆ†ç›¸å…³çš„å‚æ•°-æ–¹æ³•"><a href="#éƒ¨åˆ†ç›¸å…³çš„å‚æ•°-æ–¹æ³•" class="headerlink" title="éƒ¨åˆ†ç›¸å…³çš„å‚æ•°/æ–¹æ³•"></a>éƒ¨åˆ†ç›¸å…³çš„å‚æ•°/æ–¹æ³•</h6><ul><li><code>repeats</code> å¦‚æœæ˜¯ <code>YES</code>çš„è¯ï¼Œå®šæ—¶å™¨ä¼šä¿ç•™è‡ªèº«ï¼ŒçŸ¥é“è¢«<code>invalidate</code>åå¤±æ•ˆï¼›å¦åˆ™ä¼šåœ¨æ‰§è¡Œå®Œä»»åŠ¡ä¹‹åè‡ªåŠ¨å¤±æ•ˆï¼ˆä¸€æ¬¡æ€§å®šæ—¶å™¨ï¼‰ã€‚</li><li><code>timeInterval</code> è®¾ç½®è¿›è¡Œè§¦å‘çš„æ—¶é—´é—´éš”ã€‚</li><li><code>block</code> å¯å¸®åŠ©é¿å…å¾ªç¯å¼•ç”¨ã€‚</li><li><code>userInfo</code> ä¼ é€’çš„ç”¨æˆ·ä¿¡æ¯ï¼Œé€šè¿‡ä¼ å…¥çš„å¸¦æœ‰å‚æ•°çš„<code>selector</code>ï¼ˆ <code>- (void)timerFireMethod:(NSTimer *)timer</code>ï¼‰ï¼Œç„¶åé€šè¿‡<code>[timer userInfo]</code>è·å–ã€‚</li><li><code>- (void)fire;</code> è§¦å‘ä¸€æ¬¡ï¼Œå¯¹äºä¸€æ¬¡æ€§å®šæ—¶å™¨è¢«è§¦å‘åå°±å¤±æ•ˆï¼Œå³ä½¿è¿˜æ²¡åˆ°è®¾ç½®çš„æ­£å¸¸è§¦å‘æ—¶é—´ï¼›å¯¹äºé‡å¤æ€§å®šæ—¶å™¨ï¼Œåˆ™ä¸ä¼šå½±å“åˆ°æ­£å¸¸çš„è§¦å‘ã€‚</li></ul><hr><h6 id="å¼ºå¼•ç”¨ç›¸å…³"><a href="#å¼ºå¼•ç”¨ç›¸å…³" class="headerlink" title="å¼ºå¼•ç”¨ç›¸å…³"></a>å¼ºå¼•ç”¨ç›¸å…³</h6><ol><li><code>self.timer</code> VC ä¼šå¯¹ timer æœ‰å¼ºå¼•ç”¨ self -&gt; timer</li><li><code>addTimer:forMode:</code> runloop ä¼šå¯¹ timer æœ‰å¼ºå¼•ç”¨</li><li><code>target:</code> timer å¯¹ self æœ‰å¼ºå¼•ç”¨<br>RunLoop -&gt; timer -&gt; self ï¼Œtimer åœ¨è°ƒç”¨å invalidate åå¤±æ•ˆï¼Œæ‰ä¼šä» runloop ä¸­ç§»é™¤ï¼Œè¿›è€Œ self æ‰ä¼šé‡Šæ”¾ã€‚timer åœ¨å“ªä¸ªçº¿ç¨‹åˆ›å»ºå°±è¦åœ¨å“ªä¸ªçº¿ç¨‹è°ƒç”¨ invalidate ï¼Œå¦åˆ™ä¼šä½¿èµ„æºä¸èƒ½è¢«æ­£ç¡®çš„é‡Šæ”¾ã€‚<br>ç›´æ¥ä¸€ç‚¹<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">- (void)viewDidDisappear:(BOOL)animated &#123;</span><br><span class="line">    [super viewDidDisappear:animated];</span><br><span class="line">    </span><br><span class="line">    [self.timer invalidate];</span><br><span class="line">    self.timer = nil;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><p>å¦‚æœä¸€å®šè¦åœ¨ VC é”€æ¯åæ‰è®©å®ƒå¤±æ•ˆï¼Œåƒè¿™æ ·ğŸ‘‡<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- (void)dealloc &#123;</span><br><span class="line">    [self.timer invalidate];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>é—®é¢˜æ¥äº†ï¼Œtimer åœ¨è°ƒç”¨å invalidate åå¤±æ•ˆï¼Œç„¶å self ä¸­çš„ dealloc æ‰ä¼šè¢«è°ƒç”¨ï¼Œè€Œ invalidate å°±è¦åœ¨ dealloc ä¸­â€¦<br>é‚£ä¹ˆ<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">_weak typeof(self) weakSelf = self;</span><br><span class="line">// 1</span><br><span class="line">_timer = [NSTimer scheduledTimerWithTimeInterval:1.0f target:weakSelf selector:@selector(timerFire:) userInfo:nil repeats:YES];</span><br></pre></td></tr></table></figure></p><p>åœ¨è¿™é‡Œä¼ å…¥ weakSelf è€Œä¸æ˜¯ self çš„åŒºåˆ«åœ¨äºï¼Œå¦‚æœåœ¨ 1 çš„ä½ç½® VC é‡Šæ”¾äº†ï¼Œtarget å°±ä¸º nilã€‚ä¹Ÿå°±æ˜¯ timer ä»ç„¶å¯¹ self æœ‰å¼ºå¼•ç”¨ã€‚è¿™é‡Œä¼ å…¥ä¸€ä¸ª weakSelfï¼Œè€Œ timer å¯¹ä¼ å…¥çš„ target ä¼šè¿›è¡Œå¼ºå¼•ç”¨ï¼Œä¹Ÿå°±æ˜¯å¼ºå¼•ç”¨æŒ‡å‘äº†å¼±å¼•ç”¨æ‰€æŒ‡å‘çš„å¯¹è±¡ï¼ˆé˜²æ­¢ä¼ å…¥çš„ target è¢«çªç„¶é‡Šæ”¾ï¼‰ï¼Œç­‰ä»·äº timer ç›´æ¥å¼ºå¼•ç”¨äº†å¯¹è±¡ã€‚<br>å¦å¤–ï¼Œtimer å³ä½¿ä¸è¢«å¼•ç”¨ï¼Œä¹Ÿå¯ä»¥æ­£å¸¸è¿è¡Œï¼Œä¸ä¼šå‘ç”Ÿå¾ªç¯å¼•ç”¨ï¼Œä½†æ˜¯ä¾ç„¶ä¼šå‘ç”Ÿå†…å­˜æ³„æ¼ï¼Œ å› ä¸ºRunLoop ä¼šå¯¹å®šæ—¶å™¨çš„ target ä¿ç•™ä»¥ä¾¿åˆ°è¾¾æ—¶é—´é—´éš”åè¿›è¡Œè°ƒç”¨ã€‚</p><p>è§£å†³åŠæ³•</p><ol><li><p>åˆ†ç±»å®ç°</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">typedef void(^TExecuteTimerBlock) (NSTimer *timer);</span><br><span class="line"></span><br><span class="line">@implementation NSTimer (Helper)</span><br><span class="line">+ (NSTimer *)timer_scheduledTimerWithTimeInterval:(NSTimeInterval)inTimeInterval block:(TExecuteTimerBlock)block repeats:(BOOL)inRepeats &#123;</span><br><span class="line">    NSTimer * timer = [self scheduledTimerWithTimeInterval:inTimeInterval target:self selector:@selector(timer_executeTimerBlock:) userInfo:[block copy] repeats:inRepeats];</span><br><span class="line">    return timer;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (NSTimer *)timer_timerWithTimeInterval:(NSTimeInterval)inTimeInterval block:(TExecuteTimerBlock)block repeats:(BOOL)inRepeats &#123;</span><br><span class="line">    NSTimer * timer = [self timerWithTimeInterval:inTimeInterval target:self selector:@selector(timer_executeTimerBlock:) userInfo:[block copy] repeats:inRepeats];</span><br><span class="line">    return timer;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (void)timer_executeTimerBlock:(NSTimer *)timer; &#123;</span><br><span class="line">    if([timer userInfo]) &#123;</span><br><span class="line">        TExecuteTimerBlock block = timer.userInfo;</span><br><span class="line">        block(timer);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">@end</span><br></pre></td></tr></table></figure></li><li><p>YYWeakProxy<br>é€šè¿‡ç»§æ‰¿ NSProxyï¼Œå®šä¹‰äº†ä¸€ä¸ªå¼±å¼•ç”¨çš„ target å¯¹è±¡ï¼Œé€šè¿‡é‡å†™æ¶ˆæ¯è½¬å‘ç­‰æ–¹æ³•ï¼Œè®© target å¯¹è±¡å»å¤„ç†æ¥æ”¶åˆ°çš„æ¶ˆæ¯ã€‚<br>self -&gt; timer -&gt;  yyweakProxy<br>yyweakProxy å¯¹ self å¼±å¼•ç”¨ï¼Œä½¿å¾— self è·Ÿ timer ä¹‹é—´ä¸ä¼šæœ‰ç›¸äº’æŒæœ‰ï¼Œå°±å¯ä»¥åœ¨ self ä¸­çš„ dealloc æ–¹æ³•ä¸­æˆåŠŸè°ƒç”¨ timer çš„ invalidate</p></li></ol><h6 id="æ˜¯å¦å‡†æ—¶"><a href="#æ˜¯å¦å‡†æ—¶" class="headerlink" title="æ˜¯å¦å‡†æ—¶"></a>æ˜¯å¦å‡†æ—¶</h6><ol><li>å½“ä¸€ä¸ª timer è¢«æ³¨å†Œåˆ° runloop ä¸­åï¼Œtimer ä¼šåœ¨ä¸€ä¸ªäº‹ä»¶å¾ªç¯ä¸­è¢«æ£€æµ‹ä¸€æ¬¡ï¼Œå¦‚æœæŸä¸€æ¬¡äº‹ä»¶å¾ªç¯çš„æŒç»­æ—¶é—´è¶…è¿‡ timer çš„é—´éš”æ—¶é—´ï¼ˆå¤„ç†äº†å¤ªå¤šçš„è€—æ—¶ä»»åŠ¡ï¼‰ï¼Œé‚£ä¹ˆè¢«è¶…è¿‡çš„é‚£ä¸ªæ—¶é—´ç‚¹çš„äº‹ä»¶å°±ä¼šè¢«è·³è¿‡ã€‚çœ‹åˆ°ä¸€ä¸ªä¾‹å­æ˜¯ç­‰å…¬äº¤ï¼Œé”™è¿‡äº†è¿™ä¸ªç‚¹çš„å…¬äº¤åä½ å°±åªèƒ½ç­‰ä¸‹ä¸€ç­çš„å…¬äº¤äº†ã€‚</li><li>å¦ä¸€ä¸ªåŸå› ä¸åŠ å…¥çš„ runloop çš„æ¨¡å¼æœ‰å…³ï¼Œä¸»çº¿ç¨‹é‡Œæœ‰ä¸¤ä¸ªé¢„è®¾çš„ mode</li></ol><ul><li>kCFRunLoopDefaultMode å¹³æ—¶æ‰€å¤„çš„çŠ¶æ€</li><li>UITrackingRunLoopMode è¿½è¸ª scrollView æ»‘åŠ¨æ—¶çš„çŠ¶æ€<br>å½“åˆ›å»ºçš„ timer æ˜¯è¢«åŠ åˆ° defaultRunloopMode ä¸­ï¼Œæ»‘åŠ¨ scrollViewï¼Œrunloop ä¼šå°† mode åˆ‡æ¢ä¸º trackingRunloopModeï¼Œè¿™æ˜¯ timer å°±ä¸ä¼šè¢«å›è°ƒï¼Œä¹Ÿä¸ä¼šå½±å“åˆ°æ»‘åŠ¨æ“ä½œã€‚</li></ul><h6 id="è¡¥å……"><a href="#è¡¥å……" class="headerlink" title="è¡¥å……"></a>è¡¥å……</h6><ul><li><code>weakSelf / strongSelf</code></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">__weak __typeof__(self) weakSelf = self;</span><br><span class="line">__strong __typeof__(weakSelf) strongSelf = weakSelf;</span><br><span class="line"></span><br><span class="line">// @WeakSelf(self);</span><br><span class="line">// @StrongSelf(weakSelf);</span><br><span class="line">#define WeakSelf(type) autoreleasepool&#123;&#125; __weak __typeof__(type) weakSelf = type;</span><br><span class="line">#define StrongSelf(type) autoreleasepool&#123;&#125; __strong __typeof__(type) strongSelf = type;</span><br><span class="line"></span><br><span class="line">// WeakSelf(self);</span><br><span class="line">// StrongSelf(weakSelf);</span><br><span class="line">#define WeakSelf(type) __weak __typeof__(type) weakSelf = type;</span><br><span class="line">#define StrongSelf(type) __strong __typeof__(type) strongSelf = type;</span><br><span class="line"></span><br><span class="line">// ğŸ‘†åªé€‚ç”¨äº self,ğŸ‘‡ä½¿ç”¨é¢æ›´å¹¿ä¸€äº›</span><br><span class="line">__weak typeof(self) weakSelf = self;</span><br><span class="line">__strong typeof(self) strongSelf = weakSelf;</span><br><span class="line"></span><br><span class="line">#define WeakSelf(type) autoreleasepool&#123;&#125; __weak typeof(type) weak##type = type;</span><br><span class="line">#define StrongSelf(type) autoreleasepool&#123;&#125; __strong typeof(weak##type) strong##type = weak##type;</span><br><span class="line"></span><br><span class="line">#define WeakSelf(type) __weak typeof(type) weak##type = type;</span><br><span class="line">#define StrongSelf(type) __strong typeof(weak##type) strong##type = weak##type;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h6 id=&quot;NSTimer-å®šæ—¶å™¨&quot;&gt;&lt;a href=&quot;#NSTimer-å®šæ—¶å™¨&quot; class=&quot;headerlink&quot; title=&quot;NSTimer å®šæ—¶å™¨&quot;&gt;&lt;/a&gt;NSTimer å®šæ—¶å™¨&lt;/h6&gt;&lt;p&gt;åœ¨å›ºå®šçš„æ—¶é—´é—´éš”è¢«è§¦å‘ï¼Œè¢«è§¦å‘åç»™æŒ‡å®šçš„ç›®æ ‡å‘æ¶ˆæ¯æˆ–è€…æ‰§è¡Œä»£ç å—ä¸­å†…
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>Extension Category</title>
    <link href="http://yoursite.com/2018/06/03/Extension%20Category/"/>
    <id>http://yoursite.com/2018/06/03/Extension Category/</id>
    <published>2018-06-03T08:26:37.000Z</published>
    <updated>2018-06-03T09:05:53.000Z</updated>
    
    <content type="html"><![CDATA[<h5 id="Extension-æ‹“å±•-åŒ¿ååˆ†ç±»"><a href="#Extension-æ‹“å±•-åŒ¿ååˆ†ç±»" class="headerlink" title="Extension æ‹“å±•/åŒ¿ååˆ†ç±»"></a>Extension æ‹“å±•/åŒ¿ååˆ†ç±»</h5><p>æ˜¯åœ¨ç¼–è¯‘æœŸå†³è®®ï¼Œä½œä¸ºç±»çš„ä¸€éƒ¨åˆ†ã€‚å®ƒåœ¨ç¼–è¯‘æœŸå’Œå¤´æ–‡ä»¶é‡Œä»¥åŠå®ç°æ–‡ä»¶ä¸­çš„å†…å®¹ä¸€èµ·å½¢æˆä¸€ä¸ªå®Œæ•´çš„ç±»ã€‚</p><h6 id="ç‰¹ç‚¹"><a href="#ç‰¹ç‚¹" class="headerlink" title="ç‰¹ç‚¹"></a>ç‰¹ç‚¹</h6><ul><li>å¯ä»¥å£°æ˜æ–¹æ³•ã€å±æ€§ã€æˆå‘˜å˜é‡</li><li>ä¸€èˆ¬ç”¨äºå£°æ˜ç§æœ‰æ–¹æ³•ã€ç§æœ‰å±æ€§ã€ç§æœ‰æˆå‘˜å˜é‡</li><li>åªå­˜åœ¨äºä¸€ä¸ª.hæ–‡ä»¶ä¸­ï¼Œæˆ–åªå¯„ç”Ÿäºä¸€ä¸ªç±»çš„.mæ–‡ä»¶ä¸­ï¼Œä¾‹å¦‚<code>@interface ViewController () ... @end</code>ï¼ˆå¸¸ç”¨ï¼‰</li><li>å¿…é¡»è¦æœ‰ä¸€ä¸ªç±»çš„æºç æ‰èƒ½æ·»åŠ ä¸€ä¸ªç±»çš„æ‹“å±•ï¼Œå¯¹äºä¸€äº›ç³»ç»Ÿçš„ç±»ï¼Œå¯ä»¥é€šè¿‡åˆ›å»ºå­ç±»æ·»åŠ æ‹“å±•</li></ul><hr><h5 id="Category-åˆ†ç±»-ç±»åˆ«"><a href="#Category-åˆ†ç±»-ç±»åˆ«" class="headerlink" title="Category åˆ†ç±»/ç±»åˆ«"></a>Category åˆ†ç±»/ç±»åˆ«</h5><p>æ˜¯åœ¨è¿è¡Œæ—¶å†³è®®ï¼Œåœ¨ä¸æ”¹å˜åŸæœ‰ç±»çš„æƒ…å†µä¸‹ï¼ŒåŠ¨æ€åœ°è¿›è¡Œæ–¹æ³•_åè®®_å±æ€§çš„æ·»åŠ ï¼Œä»¥é€‚åº”ä¸åŒæƒ…å†µä¸‹çš„éœ€æ±‚ã€‚</p><h6 id="ç‰¹ç‚¹-1"><a href="#ç‰¹ç‚¹-1" class="headerlink" title="ç‰¹ç‚¹"></a>ç‰¹ç‚¹</h6><ul><li>å¯ä»¥æ·»åŠ å®ä¾‹æ–¹æ³•ã€ç±»æ–¹æ³•ï¼Œç”šè‡³å¯ä»¥å®ç°åè®®ã€æ·»åŠ å±æ€§ï¼ˆä¸ä¼šç”Ÿæˆ setter / getter æ–¹æ³•ï¼‰</li><li>ä¸å¯ä»¥æ·»åŠ å®ä¾‹å˜é‡</li><li>ä¸€èˆ¬ç”¨äºå£°æ˜ç§æœ‰æ–¹æ³•ã€ç§æœ‰å±æ€§ã€ç§æœ‰æˆå‘˜å˜é‡</li><li>åªå­˜åœ¨äºä¸€ä¸ª.hæ–‡ä»¶ä¸­ï¼Œæˆ–åªå¯„ç”Ÿäºä¸€ä¸ªç±»çš„.mæ–‡ä»¶ä¸­ï¼Œä¾‹å¦‚<code>@interface ViewController () ... @end</code>ï¼ˆå¸¸ç”¨ï¼‰</li><li>å¿…é¡»è¦æœ‰ä¸€ä¸ªç±»çš„æºç æ‰èƒ½æ·»åŠ ä¸€ä¸ªç±»çš„æ‹“å±•ï¼Œå¯¹äºä¸€äº›ç³»ç»Ÿçš„ç±»ï¼Œå¯ä»¥é€šè¿‡åˆ›å»ºå­ç±»æ·»åŠ æ‹“å±•</li></ul><h6 id="ä½¿ç”¨åœºæ™¯"><a href="#ä½¿ç”¨åœºæ™¯" class="headerlink" title="ä½¿ç”¨åœºæ™¯"></a>ä½¿ç”¨åœºæ™¯</h6><ul><li>ç»™ç°æœ‰çš„ç±»æ·»åŠ æ–¹æ³•</li><li>æŠŠç±»çš„å®ç°æ ¹æ®ä¸åŒåŠŸèƒ½ç»„ç»‡åˆ†å¼€åœ¨å‡ ä¸ªä¸åŒçš„æ–‡ä»¶ä¸­ï¼Œå‡å°‘å•ä¸ªæ–‡ä»¶çš„ä½“ç§¯ï¼ŒæŒ‰éœ€åŠ è½½</li><li>å£°æ˜ç§æœ‰æ–¹æ³•</li></ul><h6 id="æ³¨æ„"><a href="#æ³¨æ„" class="headerlink" title="æ³¨æ„"></a>æ³¨æ„</h6><p>ä¸å»ºè®®å¤å†™ç³»ç»Ÿç±»çš„æ–¹æ³•ã€‚æ·»åŠ çš„æ–¹æ³•å’Œç±»ä¸­åŸæœ‰çš„æ–¹æ³•åŒåæ—¶ï¼Œcategory ä¼šä¼˜å…ˆè°ƒç”¨ category ä¸­çš„æ–¹æ³•ã€‚ï¼ˆä¸¤è€…åŒæ—¶å­˜åœ¨äºæ–¹æ³•åˆ—è¡¨ä¸­ï¼Œåœ¨è¿è¡Œæ—¶æ–¹æ³•çš„è°ƒç”¨ç”±ç¼–è¯‘å™¨å†³å®šï¼Œæœ€åå‚ä¸ç¼–è¯‘çš„ä¼šè¢«è°ƒç”¨ï¼‰ä¼˜å…ˆçº§ä¸º åˆ†ç±» &gt; æœ¬ç±» &gt; çˆ¶ç±»ã€‚<br>ä¸¥æ ¼æ„ä¹‰ä¸Šæ¥è®²ï¼Œcategory ä¸­çš„ load åŒæ™®é€šæ–¹æ³•ä¹Ÿä¼šå¯¹ä¸»ç±»ä¸­çš„ load é€ æˆè¦†ç›–ï¼Œåªä¸è¿‡ runtime åœ¨è‡ªåŠ¨è°ƒç”¨ä¸»ç±»å’Œåˆ†ç±»ä¸­çš„ load æ˜¯ç›´æ¥ä½¿ç”¨å„è‡ªæ–¹æ³•çš„æŒ‡é’ˆè¿›è¡Œè°ƒç”¨çš„ï¼ˆæ‰‹åŠ¨è°ƒç”¨æ—¶è°ƒç”¨çš„åˆ™æ˜¯åˆ†ç±»ä¸­çš„ load æ–¹æ³•ï¼‰ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">//åˆ†ç±»ç»“æ„ä½“ å¯ä»¥æ·»åŠ å®ä¾‹æ–¹æ³•ã€ç±»æ–¹æ³•ï¼Œç”šè‡³å¯ä»¥å®ç°åè®®ã€æ·»åŠ å±æ€§</span><br><span class="line">struct category_t &#123;</span><br><span class="line">    const char *name;</span><br><span class="line">    classref_t cls;</span><br><span class="line">    struct method_list_t *instanceMethods;</span><br><span class="line">    struct method_list_t *classMethods;</span><br><span class="line">    struct protocol_list_t *protocols;</span><br><span class="line">    struct property_list_t *instanceProperties;</span><br><span class="line">    // Fields below this point are not always present on disk.</span><br><span class="line">    struct property_list_t *_classProperties;</span><br><span class="line"> </span><br><span class="line">    method_list_t *methodsForMeta(bool isMeta) &#123;</span><br><span class="line">        if (isMeta) return classMethods;</span><br><span class="line">        else return instanceMethods;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    property_list_t *propertiesForMeta(bool isMeta, struct header_info *hi);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ol><li><p>åŠ è½½åˆ†ç±»</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line">/***********************************************************************</span><br><span class="line">* _read_images</span><br><span class="line">* Perform initial processing of the headers in the linked </span><br><span class="line">* list beginning with headerList. </span><br><span class="line">*</span><br><span class="line">* Called by: map_images_nolock</span><br><span class="line">*</span><br><span class="line">* Locking: runtimeLock acquired by map_images</span><br><span class="line">**********************************************************************/</span><br><span class="line">void _read_images(header_info **hList, uint32_t hCount, int totalClasses, int unoptimizedTotalClasses)</span><br><span class="line">&#123;</span><br><span class="line">    ...</span><br><span class="line">    // Discover categories. </span><br><span class="line">    for (EACH_HEADER) &#123;</span><br><span class="line">        category_t **catlist = </span><br><span class="line">            _getObjc2CategoryList(hi, &amp;count);</span><br><span class="line">        bool hasClassProperties = hi-&gt;info()-&gt;hasCategoryClassProperties();</span><br><span class="line"></span><br><span class="line">        for (i = 0; i &lt; count; i++) &#123;</span><br><span class="line">            category_t *cat = catlist[i];</span><br><span class="line">            Class cls = remapClass(cat-&gt;cls);</span><br><span class="line"></span><br><span class="line">            if (!cls) &#123;</span><br><span class="line">                // Category&apos;s target class is missing (probably weak-linked).</span><br><span class="line">                // Disavow any knowledge of this category.</span><br><span class="line">                catlist[i] = nil;</span><br><span class="line">                if (PrintConnecting) &#123;</span><br><span class="line">                    _objc_inform(&quot;CLASS: IGNORING category \?\?\?(%s) %p with &quot;</span><br><span class="line">                                 &quot;missing weak-linked target class&quot;, </span><br><span class="line">                                 cat-&gt;name, cat);</span><br><span class="line">                &#125;</span><br><span class="line">                continue;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            // Process this category. </span><br><span class="line">            // First, register the category with its target class. å°† category å’Œå®ƒçš„ä¸»ç±»/çˆ¶ç±»æ³¨å†Œåˆ°å“ˆå¸Œè¡¨ä¸­</span><br><span class="line">            // Then, rebuild the class&apos;s method lists (etc) if  the class is realized. å¦‚æœä¸»ç±»/çˆ¶ç±»å·²ç»å®ç°ï¼Œé‡å»ºå®ƒçš„æ–¹æ³•åˆ—è¡¨</span><br><span class="line">  // åè®®è¢«åŒæ—¶æ•´åˆåˆ°ä¸»ç±»å’Œå…ƒç±»</span><br><span class="line">        // ä¸»ç±»å¯¹åº”å®ä¾‹æ–¹æ³•å’Œå±æ€§ï¼Œå…ƒç±»å¯¹åº”ç±»æ–¹æ³•</span><br><span class="line">            bool classExists = NO;</span><br><span class="line">            if (cat-&gt;instanceMethods ||  cat-&gt;protocols  </span><br><span class="line">                ||  cat-&gt;instanceProperties) </span><br><span class="line">            &#123;</span><br><span class="line">                addUnattachedCategoryForClass(cat, cls, hi);</span><br><span class="line">                if (cls-&gt;isRealized()) &#123;</span><br><span class="line">                    remethodizeClass(cls);</span><br><span class="line">                    classExists = YES;</span><br><span class="line">                &#125;</span><br><span class="line">                if (PrintConnecting) &#123;</span><br><span class="line">                    _objc_inform(&quot;CLASS: found category -%s(%s) %s&quot;, </span><br><span class="line">                                 cls-&gt;nameForLogging(), cat-&gt;name, </span><br><span class="line">                                 classExists ? &quot;on existing class&quot; : &quot;&quot;);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            if (cat-&gt;classMethods  ||  cat-&gt;protocols  </span><br><span class="line">                ||  (hasClassProperties &amp;&amp; cat-&gt;_classProperties)) </span><br><span class="line">            &#123;</span><br><span class="line">                addUnattachedCategoryForClass(cat, cls-&gt;ISA(), hi);</span><br><span class="line">                if (cls-&gt;ISA()-&gt;isRealized()) &#123;</span><br><span class="line">                    remethodizeClass(cls-&gt;ISA());</span><br><span class="line">                &#125;</span><br><span class="line">                if (PrintConnecting) &#123;</span><br><span class="line">                    _objc_inform(&quot;CLASS: found category +%s(%s)&quot;, </span><br><span class="line">                                 cls-&gt;nameForLogging(), cat-&gt;name);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ts.log(&quot;IMAGE TIMES: discover categories&quot;);</span><br><span class="line"></span><br><span class="line">    // Category discovery MUST BE LAST to avoid potential races </span><br><span class="line">    // when other threads call the new category code before </span><br><span class="line">    // this thread finishes its fixups.</span><br><span class="line"></span><br><span class="line">    // +load handled by prepare_load_methods()</span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>è·å–åˆ†ç±»åè¿›è¡Œå¤„ç†</p></li></ol><ul><li><p>è°ƒç”¨ <code>addUnattachedCategoryForClass</code>è·å–æœªæ•´åˆåˆ°æœ¬ç±»çš„åˆ†ç±»</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">/***********************************************************************</span><br><span class="line">* addUnattachedCategoryForClass</span><br><span class="line">* Records an unattached category.</span><br><span class="line">* Locking: runtimeLock must be held by the caller.</span><br><span class="line">**********************************************************************/</span><br><span class="line">static void addUnattachedCategoryForClass(category_t *cat, Class cls, </span><br><span class="line">                                          header_info *catHeader)</span><br><span class="line">&#123;</span><br><span class="line">    runtimeLock.assertWriting();</span><br><span class="line"></span><br><span class="line">    // DO NOT use cat-&gt;cls! cls may be cat-&gt;cls-&gt;isa instead</span><br><span class="line">  // å–å¾—å­˜å‚¨æ‰€æœ‰æœªæ•´åˆåˆ†ç±»çš„åˆ—è¡¨</span><br><span class="line">    NXMapTable *cats = unattachedCategories();</span><br><span class="line">    category_list *list;</span><br><span class="line"></span><br><span class="line">  // å–å¾— cls å¯¹åº”çš„æœªæ•´åˆåˆ†ç±»çš„åˆ—è¡¨</span><br><span class="line">    list = (category_list *)NXMapGet(cats, cls);</span><br><span class="line">    if (!list) &#123;</span><br><span class="line">        list = (category_list *)</span><br><span class="line">            calloc(sizeof(*list) + sizeof(list-&gt;list[0]), 1);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        list = (category_list *)</span><br><span class="line">            realloc(list, sizeof(*list) + sizeof(list-&gt;list[0]) * (list-&gt;count + 1));</span><br><span class="line">    &#125;</span><br><span class="line">  // å°†å–å¾—çš„æ–°çš„åˆ†ç±» cat æ·»åŠ åˆ°åˆšå¼€è¾Ÿå‡ºæ¥çš„ä½ç½®</span><br><span class="line">    list-&gt;list[list-&gt;count++] = (locstamped_category_t)&#123;cat, catHeader&#125;;</span><br><span class="line">  // å°†æ–°çš„ list æ’å…¥ cats ä¸­ï¼Œè¦†ç›–æ‰æ—§çš„ list</span><br><span class="line">    NXMapInsert(cats, cls, list);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>è°ƒç”¨ <code>remethodizeClass</code>é‡æ–°æ•´ç†ç±»çš„æ•°æ®ï¼Œé€šè¿‡ cls-&gt;ISA() å¾—åˆ°ä¸Šé¢æ–°çš„ list</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">/***********************************************************************</span><br><span class="line">* remethodizeClass</span><br><span class="line">* Attach outstanding categories to an existing class.</span><br><span class="line">* Fixes up cls&apos;s method list, protocol list, and property list. æ•´åˆæ–¹æ³•/å±æ€§/åè®®</span><br><span class="line">* Updates method caches for cls and its subclasses. æ›´æ–°ç±»çš„æ•°æ®å­—æ®µ</span><br><span class="line">* Locking: runtimeLock must be held by the caller</span><br><span class="line">**********************************************************************/</span><br><span class="line">static void remethodizeClass(Class cls)</span><br><span class="line">&#123;</span><br><span class="line">    category_list *cats;</span><br><span class="line">    bool isMeta;</span><br><span class="line"></span><br><span class="line">    runtimeLock.assertWriting();</span><br><span class="line"></span><br><span class="line">    isMeta = cls-&gt;isMetaClass();</span><br><span class="line"></span><br><span class="line">    // Re-methodizing: check for more categories</span><br><span class="line">  // unattachedCategoriesForClass å–å¾— cls ä¸­æœªæ•´åˆçš„åˆ†ç±»åˆ—è¡¨</span><br><span class="line">    if ((cats = unattachedCategoriesForClass(cls, false/*not realizing*/))) &#123;</span><br><span class="line">        if (PrintConnecting) &#123;</span><br><span class="line">            _objc_inform(&quot;CLASS: attaching categories to class &apos;%s&apos; %s&quot;, </span><br><span class="line">                         cls-&gt;nameForLogging(), isMeta ? &quot;(meta)&quot; : &quot;&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">  // å°†ä¸ºæ•´åˆçš„åˆ†ç±»æ•´åˆåˆ°ç±»ä¸Š</span><br><span class="line">        attachCategories(cls, cats, true /*flush caches*/);        </span><br><span class="line">        free(cats);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p>3.ä¸‹é¢ä»è¿™ä¸ªæ–¹æ³• <code>attachCategories(cls, cats, true /*flush caches*/);</code>å¼€å§‹çœ‹ï¼Œæ˜¯çœŸæ­£è¿›è¡Œå¤„ç†çš„åœ°æ–¹<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br></pre></td><td class="code"><pre><span class="line">static void </span><br><span class="line">fixupMethodList(method_list_t *mlist, bool bundleCopy, bool sort)</span><br><span class="line">&#123;</span><br><span class="line">    runtimeLock.assertWriting();</span><br><span class="line">    assert(!mlist-&gt;isFixedUp());</span><br><span class="line"></span><br><span class="line">    // fixme lock less in attachMethodLists ?</span><br><span class="line">    sel_lock();</span><br><span class="line">    </span><br><span class="line">    // Unique selectors in list.</span><br><span class="line">    for (auto&amp; meth : *mlist) &#123;</span><br><span class="line">        const char *name = sel_cname(meth.name);</span><br><span class="line">        meth.name = sel_registerNameNoLock(name, bundleCopy);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    sel_unlock();</span><br><span class="line"></span><br><span class="line">    // Sort by selector address.</span><br><span class="line">    if (sort) &#123;</span><br><span class="line">        method_t::SortBySELAddress sorter;</span><br><span class="line">        std::stable_sort(mlist-&gt;begin(), mlist-&gt;end(), sorter);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    // Mark method list as uniqued and sorted</span><br><span class="line">    mlist-&gt;setFixedUp();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">static void </span><br><span class="line">prepareMethodLists(Class cls, method_list_t **addedLists, int addedCount, </span><br><span class="line">                   bool baseMethods, bool methodsFromBundle)</span><br><span class="line">&#123;</span><br><span class="line">    runtimeLock.assertWriting();</span><br><span class="line"></span><br><span class="line">    if (addedCount == 0) return;</span><br><span class="line"></span><br><span class="line">    // Don&apos;t scan redundantly</span><br><span class="line">    bool scanForCustomRR = !cls-&gt;hasCustomRR();</span><br><span class="line">    bool scanForCustomAWZ = !cls-&gt;hasCustomAWZ();</span><br><span class="line"></span><br><span class="line">    // There exist RR/AWZ special cases for some class&apos;s base methods. </span><br><span class="line">    // But this code should never need to scan base methods for RR/AWZ: </span><br><span class="line">    // default RR/AWZ cannot be set before setInitialized().</span><br><span class="line">    // Therefore we need not handle any special cases here.</span><br><span class="line">    if (baseMethods) &#123;</span><br><span class="line">        assert(!scanForCustomRR  &amp;&amp;  !scanForCustomAWZ);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // Add method lists to array.</span><br><span class="line">    // Reallocate un-fixed method lists.</span><br><span class="line">    // The new methods are PREPENDED to the method list array.</span><br><span class="line"></span><br><span class="line">    for (int i = 0; i &lt; addedCount; i++) &#123;</span><br><span class="line">        method_list_t *mlist = addedLists[i];</span><br><span class="line">        assert(mlist);</span><br><span class="line"></span><br><span class="line">        // Fixup selectors if necessary</span><br><span class="line">        if (!mlist-&gt;isFixedUp()) &#123;</span><br><span class="line">            fixupMethodList(mlist, methodsFromBundle, true/*sort*/);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        // Scan for method implementations tracked by the class&apos;s flags</span><br><span class="line">        if (scanForCustomRR  &amp;&amp;  methodListImplementsRR(mlist)) &#123;</span><br><span class="line">            cls-&gt;setHasCustomRR();</span><br><span class="line">            scanForCustomRR = false;</span><br><span class="line">        &#125;</span><br><span class="line">        if (scanForCustomAWZ  &amp;&amp;  methodListImplementsAWZ(mlist)) &#123;</span><br><span class="line">            cls-&gt;setHasCustomAWZ();</span><br><span class="line">            scanForCustomAWZ = false;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">// Attach method lists and properties and protocols from categories to a class. å°†ç±»ä¸­çš„æ–¹æ³•å’Œåˆ†ç±»ä¸­æ–°æ·»åŠ çš„æ–¹æ³•/å±æ€§/åè®®æ•´åˆæˆåˆ°ä¸€ä¸ªç›¸åº”æ–°çš„åˆ—è¡¨ä¸­</span><br><span class="line">// Assumes the categories in cats are all loaded and sorted by load order, oldest categories first. æŒ‰åŠ è½½é¡ºåºè¿›è¡Œæ’åºï¼Œæœ€æ—§çš„é¦–å…ˆè¢«åŠ è½½ï¼Œä¹Ÿå°±æ˜¯å­˜åœ¨å¤å†™æ—¶è°ƒç”¨çš„æ˜¯æœ€åä¸€ä¸ªè¢«åŠ è½½çš„</span><br><span class="line">static void </span><br><span class="line">attachCategories(Class cls, category_list *cats, bool flush_caches)</span><br><span class="line">&#123;</span><br><span class="line">    if (!cats) return;</span><br><span class="line">    if (PrintReplacedMethods) printReplacements(cls, cats);</span><br><span class="line"></span><br><span class="line">  // ä¸»ç±»å¯¹åº”å®ä¾‹æ–¹æ³•å’Œå±æ€§ï¼Œå…ƒç±»å¯¹åº”ç±»æ–¹æ³•</span><br><span class="line">    bool isMeta = cls-&gt;isMetaClass();</span><br><span class="line"></span><br><span class="line">    // fixme rearrange to remove these intermediate allocations</span><br><span class="line">  // åœ¨å †ä¸Šåˆ›å»ºç”¨æ¥å­˜å‚¨åˆ†ç±»æ–¹æ³•/å±æ€§/åè®®çš„åˆ—è¡¨</span><br><span class="line">    method_list_t **mlists = (method_list_t **)</span><br><span class="line">        malloc(cats-&gt;count * sizeof(*mlists));</span><br><span class="line">    property_list_t **proplists = (property_list_t **)</span><br><span class="line">        malloc(cats-&gt;count * sizeof(*proplists));</span><br><span class="line">    protocol_list_t **protolists = (protocol_list_t **)</span><br><span class="line">        malloc(cats-&gt;count * sizeof(*protolists));</span><br><span class="line"></span><br><span class="line">    // Count backwards through cats to get newest categories first</span><br><span class="line">  // ä»åå¾€å‰éå†ï¼Œå°†å®ƒä»¬æ”¾å…¥å„è‡ªçš„åˆ—è¡¨ä¹‹ä¸­</span><br><span class="line">    int mcount = 0;</span><br><span class="line">    int propcount = 0;</span><br><span class="line">    int protocount = 0;</span><br><span class="line">  // ä»åå¼€å§‹ï¼Œä¼šå…ˆå–åˆ°æœ€æ–°çš„åˆ†ç±»</span><br><span class="line">    int i = cats-&gt;count;</span><br><span class="line">    bool fromBundle = NO;</span><br><span class="line">    while (i--) &#123;</span><br><span class="line">        auto&amp; entry = cats-&gt;list[i];</span><br><span class="line"></span><br><span class="line">        method_list_t *mlist = entry.cat-&gt;methodsForMeta(isMeta);</span><br><span class="line">        if (mlist) &#123;</span><br><span class="line">            mlists[mcount++] = mlist;</span><br><span class="line">            fromBundle |= entry.hi-&gt;isBundle();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        property_list_t *proplist = </span><br><span class="line">            entry.cat-&gt;propertiesForMeta(isMeta, entry.hi);</span><br><span class="line">        if (proplist) &#123;</span><br><span class="line">            proplists[propcount++] = proplist;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        protocol_list_t *protolist = entry.cat-&gt;protocols;</span><br><span class="line">        if (protolist) &#123;</span><br><span class="line">            protolists[protocount++] = protolist;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  // å–å‡º cls ä¸­çš„ class_rw_t æ•°æ®</span><br><span class="line">    auto rw = cls-&gt;data();</span><br><span class="line"></span><br><span class="line">  // å‡†å¤‡åˆ—è¡¨ä¸­æ–¹æ³• åˆ—è¡¨çš„æ•°é‡ æ˜¯å¦æ˜¯åŸºæœ¬æ–¹æ³• æ˜¯å¦æ˜¯æ¥è‡ªBundle</span><br><span class="line">    prepareMethodLists(cls, mlists, mcount, NO, fromBundle);</span><br><span class="line">  // æ·»åŠ åˆ°åˆ—è¡¨ä¸­</span><br><span class="line">    rw-&gt;methods.attachLists(mlists, mcount);</span><br><span class="line">  // é‡Šæ”¾</span><br><span class="line">    free(mlists);</span><br><span class="line">    if (flush_caches  &amp;&amp;  mcount &gt; 0) flushCaches(cls);</span><br><span class="line"></span><br><span class="line">    rw-&gt;properties.attachLists(proplists, propcount);</span><br><span class="line">    free(proplists);</span><br><span class="line"></span><br><span class="line">    rw-&gt;protocols.attachLists(protolists, protocount);</span><br><span class="line">    free(protolists);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><hr><h5 id="è¡¥å……"><a href="#è¡¥å……" class="headerlink" title="è¡¥å……"></a>è¡¥å……</h5><ul><li><p>å±æ€§<br>@property å£°æ˜çš„å˜é‡ï¼Œåœ¨ç±»ä¸­åˆ›å»ºé»˜è®¤ä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªä»¥ä¸‹åˆ’çº¿ä¸ºå¼€å¤´çš„æˆå‘˜å˜é‡ä»¥åŠ setter/getter æ–¹æ³•ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">//objc_property_t æ˜¯ä¸€ä¸ªæŒ‡å‘ objc_property ç»“æ„ä½“çš„æŒ‡é’ˆ</span><br><span class="line">typedef struct objc_property *objc_property_t;</span><br><span class="line"></span><br><span class="line">typedef struct property_t *objc_property_t;</span><br><span class="line">struct property_t &#123;</span><br><span class="line">    const char *name;</span><br><span class="line">    const char *attributes;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">//è·å–æ‰€æœ‰å±æ€§</span><br><span class="line">OBJC_EXPORT objc_property_t _Nonnull * _Nullable</span><br><span class="line">class_copyPropertyList(Class _Nullable cls, unsigned int * _Nullable outCount)</span><br><span class="line">    OBJC_AVAILABLE(10.5, 2.0, 9.0, 1.0, 2.0);</span><br><span class="line"></span><br><span class="line">objc_property_t *</span><br><span class="line">class_copyPropertyList(Class cls, unsigned int *outCount)</span><br><span class="line">&#123;</span><br><span class="line">    if (!cls) &#123;</span><br><span class="line">        if (outCount) *outCount = 0;</span><br><span class="line">        return nil;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    rwlock_reader_t lock(runtimeLock);</span><br><span class="line"></span><br><span class="line">    assert(cls-&gt;isRealized());</span><br><span class="line">    auto rw = cls-&gt;data();</span><br><span class="line"></span><br><span class="line">    property_t **result = nil;</span><br><span class="line">    unsigned int count = rw-&gt;properties.count();</span><br><span class="line">    if (count &gt; 0) &#123;</span><br><span class="line">        result = (property_t **)malloc((count + 1) * sizeof(property_t *));</span><br><span class="line"></span><br><span class="line">        count = 0;</span><br><span class="line">        for (auto&amp; prop : rw-&gt;properties) &#123;</span><br><span class="line">            result[count++] = &amp;prop;</span><br><span class="line">        &#125;</span><br><span class="line">        result[count] = nil;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if (outCount) *outCount = count;</span><br><span class="line">    return (objc_property_t *)result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//å±æ€§ç‰¹æ€§</span><br><span class="line">typedef struct &#123;</span><br><span class="line">    const char * _Nonnull name;           /**&lt; The name of the attribute */</span><br><span class="line">    const char * _Nonnull value;          /**&lt; The value of the attribute (usually empty) */</span><br><span class="line">&#125; objc_property_attribute_t;</span><br><span class="line"></span><br><span class="line">//è·å–å±æ€§å</span><br><span class="line">property_getName</span><br><span class="line">//è·å–å±æ€§ç‰¹æ€§æè¿°å­—ç¬¦ä¸²</span><br><span class="line">property_getAttributes</span><br><span class="line">//è·å–æ‰€æœ‰å±æ€§ç‰¹æ€§</span><br><span class="line">property_copyAttributeList</span><br><span class="line">//è·å–ç›¸åº”å±æ€§ç‰¹æ€§çš„ value</span><br><span class="line">property_copyAttributeValue</span><br></pre></td></tr></table></figure></li><li><p>æˆå‘˜å˜é‡<br>åœ¨ @interface æ‹¬å·ä¸­çš„ç»Ÿç§°ä¸ºæˆå‘˜å˜é‡ï¼Œç”¨äºå†…éƒ¨ï¼Œæ— éœ€ä¸å¤–ç•Œè¿›è¡Œæ¥è§¦ï¼Œå› æ­¤å®ƒä¸ä¼šç”Ÿæˆ setter/getter æ–¹æ³•ã€‚é»˜è®¤ä¿®é¥°æ˜¯ assign ï¼ˆä»…æŠŠç›®æ ‡å†…å­˜åŒºåŸŸæŒ‡é’ˆèµ‹å€¼ç»™å˜é‡ï¼Œè€Œå†…å­˜åŒºåŸŸçš„å¼•ç”¨è®¡æ•°å™¨ä¸å‘ç”Ÿå˜åŒ–ï¼‰</p></li><li><p>å®ä¾‹å˜é‡<br>æ˜¯æˆå‘˜å˜é‡ä¸­çš„ä¸€ç§ï¼Œæ˜¯ç”±ç±»å®šä¹‰çš„å˜é‡ã€‚å®ä¾‹æ˜¯é’ˆå¯¹ç±»è€Œè¨€ï¼Œæ˜¯æŒ‡ç±»çš„å£°æ˜ã€‚æˆå‘˜å˜é‡ä¸­é™¤å¼€åŸºæœ¬æ•°æ®ç±»å‹ï¼ˆint/float..ï¼‰å˜é‡ï¼Œå…¶ä»–éƒ½æ˜¯å®ä¾‹å˜é‡ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">//Ivar æŒ‡å‘ä¸€ä¸ª objc_ivar ç»“æ„ä½“</span><br><span class="line">typedef struct objc_ivar *Ivar;</span><br><span class="line"></span><br><span class="line">struct objc_ivar &#123;</span><br><span class="line">    char * _Nullable ivar_name                               OBJC2_UNAVAILABLE;</span><br><span class="line">    char * _Nullable ivar_type                               OBJC2_UNAVAILABLE;</span><br><span class="line">    int ivar_offset                                          OBJC2_UNAVAILABLE;</span><br><span class="line">#ifdef __LP64__</span><br><span class="line">    int space                                                OBJC2_UNAVAILABLE;</span><br><span class="line">#endif</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line">// è·å–æŒ‡å®šåç§°çš„æˆå‘˜å˜é‡</span><br><span class="line">class_getInstanceVariable</span><br><span class="line">//@return A pointer to an \c Ivar data structure containing information about the class variable specified by \e name.</span><br><span class="line">class_getClassVariable</span><br><span class="line">// è·å–æ‰€æœ‰æˆå‘˜å˜é‡</span><br><span class="line">class_copyIvarList</span><br><span class="line"></span><br><span class="line">// è·å–æˆå‘˜å˜é‡å</span><br><span class="line">ivar_getName</span><br><span class="line">// è·å–æˆå‘˜å˜é‡ç±»å‹ç¼–ç </span><br><span class="line">ivar_getTypeEncoding</span><br><span class="line">//è·å–å®ä¾‹å˜é‡çš„åç§»å€¼ï¼Œå½“ä¸€ä¸ªç±»è¢«ç¼–è¯‘åï¼Œå®ä¾‹å˜é‡çš„å†…å­˜å¸ƒå±€å°±å½¢æˆäº†ï¼ˆè®¿é—®å®ä¾‹å˜é‡çš„ä½ç½®ï¼‰ï¼Œå½“ç³»ç»Ÿæ£€æµ‹åˆ°è¯¥ç±»ä¸çˆ¶ç±»å‘ç”Ÿé‡å æ—¶å°±ä¼šè°ƒæ•´æ–°æ·»åŠ çš„å®ä¾‹å˜é‡çš„ä½ç½®ï¼Œä»¥å˜é‡æ‰€å ç©ºé—´ä¸ºä¾æ®äº§ç”Ÿä½ç§»ã€‚</span><br><span class="line">/**</span><br><span class="line">@note For instance variables of type \c id or other object types, call \c object_getIvar</span><br><span class="line"> *  and \c object_setIvar instead of using this offset to access the instance variable data directly.</span><br><span class="line">å¯¹äº id æˆ–è€…å…¶ä»–å¯¹è±¡ç±»å‹çš„å˜é‡ï¼Œè°ƒç”¨ object_getIvar / object_setIvar ä»£æ›¿ä½¿ç”¨</span><br><span class="line">*/</span><br><span class="line">ivar_getOffset</span><br><span class="line"></span><br><span class="line">// è·å–æŸä¸ªå¯¹è±¡æˆå‘˜å˜é‡çš„å€¼</span><br><span class="line">object_getIvar</span><br><span class="line">// è®¾ç½®æŸä¸ªå¯¹è±¡æˆå‘˜å˜é‡çš„å€¼</span><br><span class="line">object_setIvar</span><br></pre></td></tr></table></figure></li><li><p>nonatomic atomic<br>åœ¨ç³»ç»Ÿè‡ªåŠ¨ç”Ÿæˆ setter_getter æ–¹æ³•çš„å‰æä¸‹ï¼ˆæ‰‹åŠ¨å®ç°åªèµ·åˆ°æç¤ºçš„ä½œç”¨ï¼‰ï¼Œä¸¤è€…ä¹‹é—´çš„åŒºåˆ«åœ¨äº atomic  ä¼šåœ¨ setter æ–¹æ³•æ•´ä¸ª set é€»è¾‘å¤–å±‚åŠ äº’æ–¥é”ï¼ˆç­‰é”_é‡Šæ”¾é”éƒ½ä¼šæœ‰å¼€é”€ï¼‰ï¼Œä¿è¯ set åŠ¨ä½œæ˜¯åŸå­çš„ï¼›è€Œ nonatomic åˆ™ä¸ä¼šåŠ é”ï¼Œåœ¨å¤šçº¿ç¨‹æƒ…å†µä¸‹åŒæ—¶è°ƒç”¨ setter æ–¹æ³•ä¼šæœ‰æ•°æ®æ··ä¹±çš„é£é™©ã€‚<br>å¦å¤–ï¼Œatomic ä¸èƒ½ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œè¿˜éœ€è¦æ‰‹åŠ¨åŠ é”ã€‚åœ¨å•æ ¸CPUä¸­å¯ä»¥ä¿è¯è¯»å†™å®‰å…¨ï¼›åœ¨å¤šæ ¸CPUä¸­ï¼Œä¸€å¯èƒ½å­˜åœ¨å¤šä¸ªå“åº”åœ¨ä¸åŒçº¿ç¨‹ä¸­å¯¹åŒä¸€å˜é‡è°ƒç”¨ setter æ–¹æ³•ï¼›äºŒåœ¨å•ä¸ªå“åº”çš„åŒæ—¶ï¼Œå¯èƒ½ä¼šæœ‰å¦ä¸€ä¸ªå‘¨æœŸæ€§çš„ä»»åŠ¡åœ¨å¦ä¸€ä¸ªçº¿ç¨‹ä¸­ä¹Ÿè°ƒç”¨ setter æ–¹æ³•ï¼›åœ¨åŒä¸€æ—¶é—´ç‚¹ï¼Œä¸åŒæ—¶é—´ç‚¹è°ƒç”¨ setter æ–¹æ³•ã€‚</p></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h5 id=&quot;Extension-æ‹“å±•-åŒ¿ååˆ†ç±»&quot;&gt;&lt;a href=&quot;#Extension-æ‹“å±•-åŒ¿ååˆ†ç±»&quot; class=&quot;headerlink&quot; title=&quot;Extension æ‹“å±•/åŒ¿ååˆ†ç±»&quot;&gt;&lt;/a&gt;Extension æ‹“å±•/åŒ¿ååˆ†ç±»&lt;/h5&gt;&lt;p&gt;æ˜¯åœ¨ç¼–è¯‘æœŸå†³è®®ï¼Œä½œä¸º
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>è®¿é—® ä»¥åŠä¿®æ”¹ç§æœ‰å±æ€§</title>
    <link href="http://yoursite.com/2018/05/27/%E8%AE%BF%E9%97%AE%20%E4%BB%A5%E5%8F%8A%E4%BF%AE%E6%94%B9%E7%A7%81%E6%9C%89%E5%B1%9E%E6%80%A7%20%E4%B8%8B%E5%8D%885.42.09/"/>
    <id>http://yoursite.com/2018/05/27/è®¿é—® ä»¥åŠä¿®æ”¹ç§æœ‰å±æ€§ ä¸‹åˆ5.42.09/</id>
    <published>2018-05-27T14:10:50.000Z</published>
    <updated>2018-06-03T08:37:03.000Z</updated>
    
    <content type="html"><![CDATA[<h5 id="è®¿é—®-ä»¥åŠä¿®æ”¹ç§æœ‰å±æ€§ï¼š"><a href="#è®¿é—®-ä»¥åŠä¿®æ”¹ç§æœ‰å±æ€§ï¼š" class="headerlink" title="è®¿é—® ä»¥åŠä¿®æ”¹ç§æœ‰å±æ€§ï¼š"></a>è®¿é—® ä»¥åŠä¿®æ”¹ç§æœ‰å±æ€§ï¼š</h5><ol><li><code>KVC</code><br><code>setValue:forKey:</code><br><code>valueForKey:</code></li><li><code>runtime</code><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">A *a = [[A alloc]init];</span><br><span class="line"></span><br><span class="line">unsigned int count = 0;</span><br><span class="line">Ivar *ivars = class_copyIvarList([A class], &amp;count);</span><br><span class="line">for (int i = 0; i &lt; count; i++) &#123;</span><br><span class="line">    Ivar ivar = ivars[i];</span><br><span class="line">    </span><br><span class="line">    // å–å¾—å±æ€§åå¹¶è½¬æˆå­—ç¬¦ä¸²ç±»å‹</span><br><span class="line">    const char *ivarName = ivar_getName(ivar);</span><br><span class="line">    NSLog(@&quot;%s&quot;,ivarName);</span><br><span class="line">    </span><br><span class="line">    Ivar firstIvar = ivars[0];</span><br><span class="line">    // ä¿®æ”¹å±æ€§å€¼</span><br><span class="line">    object_setIvar(a, firstIvar, @&quot;aaa&quot;);</span><br><span class="line">    NSLog(@&quot;%@&quot;,object_getIvar(a, firstIvar));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h5 id="KVCé”®å€¼ç¼–ç "><a href="#KVCé”®å€¼ç¼–ç " class="headerlink" title="KVCé”®å€¼ç¼–ç "></a><code>KVC</code>é”®å€¼ç¼–ç </h5><p>æ˜¯ä¸€ç§å¯ä»¥é€šè¿‡<code>key</code>å±æ€§åæ¥è®¿é—®ç±»å±æ€§çš„æœºåˆ¶ï¼Œè€Œä¸æ˜¯é€šè¿‡è°ƒç”¨<code>setter</code> <code>getter</code>æ–¹æ³•æ¥è®¿é—®ã€‚åŒæ—¶æ”¯æŒç±»å¯¹è±¡å’Œå†…å»ºåŸºæœ¬æ•°æ®ç±»å‹ï¼Œä»¥åŠé›†åˆè¿ç®—ç¬¦ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">//åŠ¨æ€è¯»å–</span><br><span class="line">valueForKey:ç”¨äºç®€å•è·¯å¾„</span><br><span class="line">valueForKeyPath: ç”¨äºå¤åˆè·¯å¾„ï¼Œxx.xx</span><br><span class="line">valueForUndefinedKey é»˜è®¤å®ç°æ˜¯æŠ›å‡ºå¼‚å¸¸ï¼Œå¯é‡å†™è¿™ä¸ªå‡½æ•°åšé”™è¯¯å¤„ç†</span><br><span class="line"></span><br><span class="line">//åŠ¨æ€è®¾ç½®</span><br><span class="line">setValue:forKey:</span><br><span class="line">setValue:forKeyPath:</span><br><span class="line">setValue:forUnderfinedKey:</span><br><span class="line">setNilValueForKey: å¯¹éç±»å¯¹è±¡å±æ€§è®¾ç½®nilæ—¶è°ƒç”¨ï¼Œé»˜è®¤æŠ›å‡ºå¼‚å¸¸ã€‚</span><br><span class="line"></span><br><span class="line">//é”®å€¼éªŒè¯</span><br><span class="line">- (BOOL)validateValue:(inout id *)ioValue forKey:(NSString *)inKey error:(out NSError **)outError;</span><br><span class="line"></span><br><span class="line">//é›†åˆè¿ç®—ç¬¦ï¼Œä½œä¸ºä¸€ä¸ªç‰¹æ®Šçš„KeyPathå‚æ•°ä¼ å…¥</span><br><span class="line">æ ¼å¼ï¼šé›†åˆè·¯å¾„.@+é›†åˆè¿ç®—ç¬¦.å±æ€§keyPath</span><br><span class="line">//ç®€å•è¿ç®—ç¬¦</span><br><span class="line">@avgï¼Œ @count ï¼Œ @max ï¼Œ @min ï¼Œ@sum</span><br><span class="line">//å¯¹è±¡è¿ç®—ç¬¦ï¼Œä»¥æ•°ç»„å½¢å¼è¿”å›</span><br><span class="line">@distinctUnionOfObjectsï¼Œ@unionOfObjects</span><br><span class="line">//Arrayå’ŒSetæ“ä½œç¬¦ï¼Œé’ˆå¯¹çš„æ˜¯é›†åˆä¸­åŒ…å«é›†åˆçš„æƒ…å†µ</span><br><span class="line">@distinctUnionOfArraysï¼Œ@unionOfArraysï¼Œ@distinctUnionOfSets</span><br></pre></td></tr></table></figure></p><h6 id="å±æ€§è¯»å–æŸ¥æ‰¾è§„åˆ™"><a href="#å±æ€§è¯»å–æŸ¥æ‰¾è§„åˆ™" class="headerlink" title="å±æ€§è¯»å–æŸ¥æ‰¾è§„åˆ™"></a>å±æ€§è¯»å–æŸ¥æ‰¾è§„åˆ™</h6><ul><li>åŠ¨æ€è®¾ç½®</li></ul><ol><li>é¦–å…ˆæœç´¢<code>setKey:</code>æ–¹æ³•ã€‚</li><li>ä¸Šé¢çš„<code>setter</code>æ–¹æ³•æ²¡æ‰¾åˆ°ï¼Œå¦‚æœç±»æ–¹æ³•<code>accessInstanceVariablesDirectly</code>è¿”å›<code>YES</code>ã€‚é‚£ä¹ˆæŒ‰ <code>_key</code>ï¼Œ<code>_isKey</code>ï¼ˆåªé’ˆå¯¹å¸ƒå°”å€¼æœ‰æ•ˆï¼‰ï¼Œ<code>key</code>ï¼Œ<code>iskey</code>çš„é¡ºåºæœç´¢æˆå‘˜åã€‚ï¼ˆ<code>NSKeyValueCodingCatogery</code>ä¸­å®ç°çš„ç±»æ–¹æ³•ï¼Œé»˜è®¤å®ç°ä¸ºè¿”å›YESï¼‰</li><li>å¦‚æœæ²¡æœ‰æ‰¾åˆ°æˆå‘˜å˜é‡ï¼Œè°ƒç”¨<code>setValue:forUnderfinedKey:</code></li></ol><ul><li>åŠ¨æ€è¯»å–</li></ul><ol><li>é¦–å…ˆæŒ‰<code>getKey</code>ï¼Œ<code>key</code>ï¼Œ<code>isKey</code>çš„é¡ºåºæŸ¥æ‰¾<code>getter</code>æ–¹æ³•ï¼Œæ‰¾åˆ°ç›´æ¥è°ƒç”¨ã€‚å¦‚æœæ˜¯<code>BOOL</code>ã€<code>Int</code>ç­‰å†…å»ºå€¼ç±»å‹ï¼Œä¼šåš<code>NSNumber</code>çš„è½¬æ¢ã€‚</li><li>ä¸Šé¢çš„<code>getter</code>æ²¡æ‰¾åˆ°ï¼ŒæŸ¥æ‰¾<code>countOfKey</code>ã€<code>objectInKeyAtindex</code>ã€<code>KeyAtindexes</code>æ ¼å¼çš„æ–¹æ³•ã€‚å¦‚æœ<code>countOfKey</code>å’Œå¦å¤–ä¸¤ä¸ªæ–¹æ³•ä¸­çš„ä¸€ä¸ªæ‰¾åˆ°ï¼Œé‚£ä¹ˆå°±ä¼šè¿”å›ä¸€ä¸ªå¯ä»¥å“åº”NSArrayæ‰€æœ‰æ–¹æ³•çš„ä»£ç†é›†åˆçš„NSArrayæ¶ˆæ¯æ–¹æ³•ã€‚</li><li>è¿˜æ²¡æ‰¾åˆ°ï¼ŒæŸ¥æ‰¾<code>countOfKey</code>ã€<code>enumeratorOfKey</code>ã€<code>memberOfKey</code>æ ¼å¼çš„æ–¹æ³•ã€‚å¦‚æœè¿™ä¸‰ä¸ªæ–¹æ³•éƒ½æ‰¾åˆ°ï¼Œé‚£ä¹ˆå°±è¿”å›ä¸€ä¸ªå¯ä»¥å“åº”NSSetæ‰€æœ‰æ–¹æ³•çš„ä»£ç†é›†åˆã€‚</li><li>è¿˜æ˜¯æ²¡æ‰¾åˆ°ï¼Œå¦‚æœç±»æ–¹æ³•<code>accessInstanceVariablesDirectly</code>è¿”å›YESã€‚é‚£ä¹ˆæŒ‰ <code>_key</code>ï¼Œ<code>_isKey</code>ï¼Œ<code>key</code>ï¼Œ<code>iskey</code>çš„é¡ºåºæœç´¢æˆå‘˜åã€‚</li><li>å†æ²¡æ‰¾åˆ°ï¼Œè°ƒç”¨<code>valueForUndefinedKey</code>ã€‚</li></ol><h5 id="KVOé”®å€¼ç›‘å¬"><a href="#KVOé”®å€¼ç›‘å¬" class="headerlink" title="KVOé”®å€¼ç›‘å¬"></a><code>KVO</code>é”®å€¼ç›‘å¬</h5><p>æ˜¯ä¸€ç§è§‚å¯Ÿè€…æ¨¡å¼ï¼Œæä¾›äº†ä¸€ç§å½“è¢«ç›‘å¬å¯¹è±¡ï¼ˆé€šå¸¸æ˜¯æ•°æ®æ¨¡å‹ï¼‰å±æ€§è¢«ä¿®æ”¹çš„æ—¶å€™ä¸ºå…¶æ³¨å†Œç›‘å¬çš„å¯¹è±¡å°±èƒ½åŠæ—¶å¾—åˆ°é€šçŸ¥ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">//æ³¨å†Œ</span><br><span class="line">addObserver: forKeyPath: options:  context:</span><br><span class="line"></span><br><span class="line">//åˆ é™¤</span><br><span class="line">removeObserver: forKeyPath</span><br><span class="line">removeObserver: forKeyPath: context:</span><br><span class="line"></span><br><span class="line">//å›è°ƒ</span><br><span class="line">observeValueForKeyPath: ofObject: change: context:</span><br></pre></td></tr></table></figure></p><h6 id="isa-swizzling-KVC-KVOå®ç°åŸç†"><a href="#isa-swizzling-KVC-KVOå®ç°åŸç†" class="headerlink" title="isa-swizzling KVC/KVOå®ç°åŸç†"></a><code>isa-swizzling</code> <code>KVC/KVO</code>å®ç°åŸç†</h6><ul><li>æ³¨å†Œç›‘å¬<blockquote><p>å°†è¢«è§‚å¯Ÿå¯¹è±¡çš„<code>isa</code>æŒ‡é’ˆæŒ‡å‘è¯¥ç±»çš„ä¸€ä¸ªæ´¾ç”Ÿç±»ï¼Œåœ¨è¿™ä¸ªåˆ›å»ºçš„æ´¾ç”Ÿç±»ä¸­é‡å†™åŸºç±»ä¸­ä»»ä½•è¢«è§‚å¯Ÿå±æ€§çš„ setter æ–¹æ³•ã€‚è€Œæ´¾ç”Ÿç±»åœ¨è¢«é‡å†™çš„ setter æ–¹æ³•å®ç°çœŸæ­£çš„é€šçŸ¥æœºåˆ¶ã€‚åŒæ—¶æ´¾ç”Ÿç±»è¿˜é‡å†™äº† class æ–¹æ³•ä»¥â€œæ¬ºéª—â€å¤–éƒ¨è°ƒç”¨è€…å®ƒå°±æ˜¯èµ·åˆçš„é‚£ä¸ªç±»ã€‚ç„¶åç³»ç»Ÿå°†è¿™ä¸ªå¯¹è±¡çš„ isa æŒ‡é’ˆæŒ‡å‘è¿™ä¸ªæ–°è¯ç”Ÿçš„æ´¾ç”Ÿç±»ï¼Œå› æ­¤è¿™ä¸ªå¯¹è±¡å°±æˆä¸ºè¯¥æ´¾ç”Ÿç±»çš„å¯¹è±¡äº†ï¼Œå› è€Œåœ¨è¯¥å¯¹è±¡ä¸Šå¯¹ setter çš„è°ƒç”¨å°±ä¼šè°ƒç”¨é‡å†™çš„ setterï¼Œä»è€Œæ¿€æ´»é”®å€¼é€šçŸ¥æœºåˆ¶ã€‚<br><a href="http://blog.csdn.net/kesalin/article/details/8194240" target="_blank" rel="noopener">è¯¦è§£é”®å€¼è§‚å¯Ÿï¼ˆKVOï¼‰åŠå…¶å®ç°æœºç†</a>  </p></blockquote></li></ul><ol><li><p>é‡å†™ <code>setter</code>ï¼Œå¢åŠ çš„æ–¹æ³•ä»¥é€šçŸ¥ç³»ç»Ÿå±æ€§å€¼å·²ç»æ”¹å˜ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">//é€šçŸ¥ç³»ç»Ÿkeyå¯¹åº”çš„å±æ€§å€¼å³å°†/å·²ç»å‘ç”Ÿæ”¹å˜</span><br><span class="line">- (void)willChangeValueForKey:(NSString *)key;</span><br><span class="line">- (void)didChangeValueForKey:(NSString *)key;</span><br></pre></td></tr></table></figure></li><li><p>é‡å†™<code>class</code>ï¼Œè¿”å›è·Ÿæœªå»ºç«‹ç›‘å¬ä¹‹å‰ä¸€æ ·çš„ç»“æœï¼Œä¹‹ååŠ¨æ€ä¿®æ”¹<code>isa</code>çš„æŒ‡å‘ã€‚</p></li></ol><ul><li>åˆ é™¤ç›‘å¬<br>å°†<code>isa</code>æŒ‡å‘åŸå…ˆçš„ç±»å¯¹è±¡ä¸­ã€‚</li></ul><h6 id="è¡¥å……"><a href="#è¡¥å……" class="headerlink" title="è¡¥å……"></a>è¡¥å……</h6><ul><li><p><code>id</code><br>æ˜¯ä¸€ä¸ª<code>objc_object</code>ç»“æ„ç±»å‹çš„æŒ‡é’ˆï¼ŒæŒ‡å‘ç±»å®ä¾‹ã€‚<br><code>typedef struct objc_object *id;</code></p></li><li><p><code>objc_object</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">struct objc_object &#123;</span><br><span class="line">    Class _Nonnull isa  OBJC_ISA_AVAILABILITY;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></li><li><p><code>Class</code><br>æ˜¯ä¸€ä¸ª<code>objc_class</code>ç»“æ„ç±»å‹çš„æŒ‡é’ˆã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">struct objc_class &#123;</span><br><span class="line">    Class _Nonnull isa  OBJC_ISA_AVAILABILITY;</span><br><span class="line"></span><br><span class="line">#if !__OBJC2__</span><br><span class="line">    Class _Nullable super_class                              </span><br><span class="line">    const char * _Nonnull name                               </span><br><span class="line">    long version                                             </span><br><span class="line">    long info                                                </span><br><span class="line">    long instance_size                                       </span><br><span class="line">    struct objc_ivar_list * _Nullable ivars                  </span><br><span class="line">    struct objc_method_list * _Nullable * _Nullable </span><br><span class="line">    struct objc_cache * _Nonnull cache                       </span><br><span class="line">    struct objc_protocol_list * _Nullable protocols          </span><br><span class="line">#endif</span><br><span class="line"></span><br><span class="line">&#125; OBJC2_UNAVAILABLE;</span><br></pre></td></tr></table></figure></li></ul><ol><li><code>objc_class</code>ç»§æ‰¿äº<code>objc_object</code>ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ªç±»ä¹Ÿå¯ä»¥è¯´æ˜¯ä¸€ä¸ªå¯¹è±¡ã€‚ï¼ˆæ¯ä¸€ä¸ªå¯¹è±¡å†…éƒ¨éƒ½ä¼šæœ‰ä¸€ä¸ª<code>isa</code>æŒ‡é’ˆï¼ŒæŒ‡å‘è¯¥å¯¹è±¡çš„ç±»ã€‚å½“ä¸€ä¸ªæ¶ˆæ¯å‘é€ç»™ä¸€ä¸ªå¯¹è±¡åï¼Œæ–¹æ³•çš„æ£€æŸ¥ä»å¯¹è±¡çš„<code>isa</code>æŒ‡é’ˆå¼€å§‹ï¼Œå®ä¾‹æ–¹æ³•å®šä¹‰åœ¨å¯¹è±¡çš„ç±»ä¸­ï¼Œå¦‚æœåœ¨è¿™é‡Œæ²¡æœ‰æ‰¾åˆ°ï¼Œåˆ™åˆ°è¶…ç±»ä¸­æŸ¥æ‰¾ã€‚ï¼‰</li><li>ç±»æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œæ‰€ä»¥å®ƒä¹Ÿä¼šæ˜¯å¦ä¸€ä¸ªç±»çš„å®ä¾‹ï¼Œè¿™ä¸ªç±»å°±æ˜¯å…ƒç±»<code>Meta Class</code>ã€‚å…ƒç±»ç”¨æ¥è¡¨è¿°ç±»å¯¹è±¡æœ¬èº«æ‰€å…·å¤‡çš„å…ƒæ•°æ®ï¼Œç±»æ–¹æ³•å°±å®šä¹‰åœ¨è¿™é‡Œã€‚ï¼ˆå½“ä¸€ä¸ªç±»æ–¹æ³•è¢«è°ƒç”¨åï¼Œå…ˆæŸ¥æ‰¾è‡ªèº«ï¼Œå¦‚æœæ²¡æœ‰å°±ä¼šä»ç»§æ‰¿é“¾ä¸­æŸ¥æ‰¾ã€‚ï¼‰</li><li>å…ƒç±»åŒæ—¶ä¹Ÿæ˜¯ä¸€ä¸ªæ ¹å…ƒç±»<code>root meta class</code>çš„å®ä¾‹ã€‚æ ¹å…ƒç±»çš„<code>super_class</code>æŒ‡å‘<code>NSObject</code>ï¼Œ<code>isa</code>æŒ‡å‘è‡ªèº«ã€‚<code>NSObject</code>çš„<code>super_class</code>æŒ‡å‘<code>nil</code>ã€‚</li></ol><p><img src="%E8%AE%BF%E9%97%AE%20%E4%BB%A5%E5%8F%8A%E4%BF%AE%E6%94%B9%E7%A7%81%E6%9C%89%E5%B1%9E%E6%80%A7%EF%BC%9A/class-diagram.jpg" alt=""></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h5 id=&quot;è®¿é—®-ä»¥åŠä¿®æ”¹ç§æœ‰å±æ€§ï¼š&quot;&gt;&lt;a href=&quot;#è®¿é—®-ä»¥åŠä¿®æ”¹ç§æœ‰å±æ€§ï¼š&quot; class=&quot;headerlink&quot; title=&quot;è®¿é—® ä»¥åŠä¿®æ”¹ç§æœ‰å±æ€§ï¼š&quot;&gt;&lt;/a&gt;è®¿é—® ä»¥åŠä¿®æ”¹ç§æœ‰å±æ€§ï¼š&lt;/h5&gt;&lt;ol&gt;
&lt;li&gt;&lt;code&gt;KVC&lt;/code&gt;&lt;br&gt;&lt;cod
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>å“åº”é“¾</title>
    <link href="http://yoursite.com/2018/05/26/%E5%93%8D%E5%BA%94%E9%93%BE/"/>
    <id>http://yoursite.com/2018/05/26/å“åº”é“¾/</id>
    <published>2018-05-26T13:49:42.000Z</published>
    <updated>2018-06-03T08:37:47.000Z</updated>
    
    <content type="html"><![CDATA[<h5 id="å“åº”è€…å¯¹è±¡"><a href="#å“åº”è€…å¯¹è±¡" class="headerlink" title="å“åº”è€…å¯¹è±¡"></a>å“åº”è€…å¯¹è±¡</h5><p>æŒ‡å¯ä»¥æ¥æ”¶å¹¶å¤„ç†äº‹ä»¶çš„å¯¹è±¡ã€‚ <code>UIResponder</code> æ˜¯æ‰€æœ‰å“åº”è€…å¯¹è±¡çš„åŸºç±»ã€‚</p><p>è€Œåœ¨ä¸€ä¸‹å‡ ç§æƒ…å†µä¸‹ä¸èƒ½æ¥æ”¶äº‹ä»¶ï¼š</p><ol><li><code>view.userInteractionEnabled = NO</code> ä¸ä¸ç”¨æˆ·äº¤äº’</li><li><code>view.hidden = NO</code> éšè—</li><li><code>view.alpha = 0</code> é€æ˜</li><li>æ­£å¸¸æƒ…å†µä¸‹ï¼Œå¯¹å­è§†å›¾åœ¨çˆ¶è§†å›¾ä¹‹å¤–çš„åŒºåŸŸä¸ä¼šè¢«è¯†åˆ«</li></ol><h5 id="å“åº”è€…é“¾"><a href="#å“åº”è€…é“¾" class="headerlink" title="å“åº”è€…é“¾"></a>å“åº”è€…é“¾</h5><p>æ˜¯ä¸€ç³»åˆ—è¿æ¥åœ¨ä¸€èµ·çš„å“åº”è€…å¯¹è±¡ï¼Œå®ƒå…è®¸å“åº”è€…å¯¹è±¡å°†å¤„ç†äº‹ä»¶çš„è´£ä»»ä¼ é€’ç»™å…¶ä»–æ›´é«˜çº§åˆ«çš„å¯¹è±¡ã€‚éšç€ç¨‹åºå¯»æ‰¾èƒ½å¤Ÿå¤„ç†äº‹ä»¶çš„å¯¹è±¡ï¼Œäº‹ä»¶å°±åœ¨å“åº”è€…é“¾ä¸­å‘ä¸Šä¼ é€’ã€‚<br>äº‹ä»¶çš„ä¼ é€’æ˜¯ä»ä¸Šåˆ°ä¸‹çš„ï¼Œäº‹ä»¶çš„å“åº”æ˜¯ä»ä¸‹åˆ°ä¸Šçš„ã€‚</p><h5 id="åº”ç”¨"><a href="#åº”ç”¨" class="headerlink" title="åº”ç”¨"></a>åº”ç”¨</h5><ol><li>å¯ä»¥é€šè¿‡é‡å†™<code>hitTest:withEvent:</code>è®¾ç½®äº‹ä»¶å¤„ç†çš„ä¼ é€’é“¾ï¼Œè‡ªå·±å¤„ç†æˆ–è€…å¾€åä¼ é€’ç»™å…¶ä»–å“åº”è€…å¤„ç†ï¼Œç”šè‡³åˆ°æœ€å<code>UIApplication</code>éƒ½ä¸å¤„ç†å°±ä¸¢å¼ƒäº‹ä»¶ã€‚ä¹Ÿå¯ä»¥è®©å½“å‰å“åº”å¯¹è±¡å’Œå®ƒçš„ä¸‹ä¸€å“åº”å¯¹è±¡åŒæ—¶å¯¹ä¸€æ¬¡ç‚¹å‡»å¯¹è±¡ä½œå‡ºå¤„ç†ã€‚</li><li>å¯ä»¥é€šè¿‡<code>pointInside: withEvent:</code>åˆ¤æ–­ç‚¹æ˜¯å¦è¢«å½“å‰çš„å“åº”è€…å¤„ç†ï¼Œä¹Ÿå¯ä»¥é€šè¿‡é‡å†™è¯¥æ–¹æ³•æ›´æ”¹å“åº”å¯¹è±¡çš„å“åº”çƒ­åŒºã€‚</li></ol><h5 id="UIResponderå“åº”è€…ç±»"><a href="#UIResponderå“åº”è€…ç±»" class="headerlink" title="UIResponderå“åº”è€…ç±»"></a><code>UIResponder</code>å“åº”è€…ç±»</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">//è·å–ä¸‹ä¸€ä¸ªå“åº”è€…</span><br><span class="line">- (UIResponder*)nextResponder;</span><br><span class="line"></span><br><span class="line">//å½“å®ƒæ”¾å¼ƒå¯¹è±¡å“åº”è€…,å¯ä»¥è®¾ç½®è‡ªèº«æˆä¸ºç¬¬ä¸€å“åº”è€…,é»˜è®¤ä¸ºNO</span><br><span class="line">- (BOOL)canBecomeFirstResponder;</span><br><span class="line"></span><br><span class="line">//è®¾ç½®ç¬¬ä¸€å“åº”è€…</span><br><span class="line">- (BOOL)becomeFirstResponder;</span><br><span class="line"></span><br><span class="line">//å¦‚æœä¸€ä¸ªå¯¹è±¡å¯ä»¥æ”¾å¼ƒå¯¹è±¡å“åº”è€…å°±è¿”å›YES,é»˜è®¤è¿”å›YES</span><br><span class="line">- (BOOL)canResignFirstResponder;</span><br><span class="line"></span><br><span class="line">//æ”¾å¼ƒç¬¬ä¸€å“åº”è€…</span><br><span class="line">- (BOOL)resignFirstResponder;</span><br><span class="line"></span><br><span class="line">//æ˜¯å¦æ˜¯ç¬¬ä¸€å“åº”è€…</span><br><span class="line">- (BOOL)isFirstResponder;</span><br></pre></td></tr></table></figure><p>ä¸€èˆ¬å“åº”çš„å‡ ç§äº‹ä»¶</p><ol><li><code>Touch Events</code>è§¦æ‘¸äº‹ä»¶</li><li><code>Press Events</code>ç‚¹æŒ‰äº‹ä»¶</li><li><code>Motion Events</code>è¿åŠ¨äº‹ä»¶</li><li><code>RemoteControl Events</code>è¿œç¨‹äº‹ä»¶</li></ol><h5 id="ä»ç”¨æˆ·è§¦å±å¼€å§‹åˆ°å›¾å½¢ç³»ç»Ÿæ›´æ–°å±å¹•æ¥å“åº”ç»“æŸ"><a href="#ä»ç”¨æˆ·è§¦å±å¼€å§‹åˆ°å›¾å½¢ç³»ç»Ÿæ›´æ–°å±å¹•æ¥å“åº”ç»“æŸ" class="headerlink" title="ä»ç”¨æˆ·è§¦å±å¼€å§‹åˆ°å›¾å½¢ç³»ç»Ÿæ›´æ–°å±å¹•æ¥å“åº”ç»“æŸ"></a>ä»ç”¨æˆ·è§¦å±å¼€å§‹åˆ°å›¾å½¢ç³»ç»Ÿæ›´æ–°å±å¹•æ¥å“åº”ç»“æŸ</h5><ol><li>ç”¨æˆ·è§¦å±</li><li>ç¡¬ä»¶æŠ¥å‘Šè§¦æ‘¸äº‹ä»¶ç»™<code>UIKit</code>æ¡†æ¶</li><li><code>UIKit</code>æ¡†æ¶å°†è§¦æ‘¸äº‹ä»¶æ‰“åŒ…æˆ<code>UIEvent</code>å¯¹è±¡ï¼ŒåŒæ—¶åˆ†å‘ç»™é€‚åˆçš„è§†å›¾<code>Event Handing</code></li><li>è§†å›¾ä¸­çš„äº‹ä»¶å¤„ç†ä»£ç å¯èƒ½è¿›è¡Œä»¥ä¸‹çš„åŠ¨ä½œæ¥å“åº”ï¼šæ”¹å˜è§†å›¾æˆ–è€…å…¶å­è§†å›¾çš„å±æ€§ï¼›è°ƒç”¨ <code>setNeedsLayout</code> æ–¹æ³•ä»¥æ ‡è®°è¯¥è§†å›¾æˆ–è€…å…¶å­è§†å›¾éœ€è¦è¿›è¡Œå¸ƒå±€æ›´æ–°ï¼›è°ƒç”¨ <code>setNeedsDisplay</code> æˆ–è€… <code>setNeedsDisplayInRect</code> ä»¥æ ‡è®°è¯¥è§†å›¾æˆ–è€…å…¶å­è§†å›¾éœ€è¦è¿›è¡Œé‡ç”»ï¼›é€šçŸ¥ä¸€ä¸ªæ§åˆ¶å™¨å…³äºä¸€äº›æ•°æ®çš„æ›´æ–°</li><li>å¦‚æœä¸€ä¸ªè§†å›¾çš„å‡ ä½•ç»“æ„æ”¹å˜äº†ï¼Œ<code>UIKit</code>ä¼šæ ¹æ®ä»¥ä¸‹å‡ æ¡è§„åˆ™æ¥æ›´æ–°å®ƒçš„å­è§†å›¾ï¼šè‡ªåŠ¨é‡è®¾å°ºå¯¸ <code>Layout Changes Automatically Using Autoresizing Rules</code>ï¼›å®ç° <code>ayoutSubviews</code>  åœ¨å®šåˆ¶è§†å›¾ä¸­è¦†ç›–è¿™ä¸ªæ–¹æ³•åŒæ—¶ç”¨å®ƒæ¥è°ƒæ•´ä»»ä½•å­è§†å›¾çš„ä½ç½®å’Œå¤§å°</li><li>å¦‚æœä»»ä½•è§†å›¾çš„ä»»ä½•éƒ¨åˆ†è¢«æ ‡è®°ä¸ºéœ€è¦é‡ç”»ï¼ŒUIKit ä¼šè¦æ±‚è§†å›¾é‡ç”»è‡ªèº«<code>drawRectï¼š</code></li><li>ä»»ä½•å·²ç»æ›´æ–°çš„è§†å›¾ä¼šä¸åº”ç”¨ä½™ä¸‹çš„å¯è§†å†…å®¹ç»„åˆåˆ°ä¸€èµ·ï¼ŒåŒæ—¶è¢«å‘é€åˆ°å›¾å½¢ç¡¬ä»¶å»æ˜¾ç¤º</li><li>å›¾å½¢ç¡¬ä»¶å°†å·²è§£é‡Šå†…å®¹è½¬åŒ–åˆ°å±å¹•ä¸Š</li></ol><h5 id="äº‹ä»¶çš„äº§ç”Ÿå’Œä¼ é€’"><a href="#äº‹ä»¶çš„äº§ç”Ÿå’Œä¼ é€’" class="headerlink" title="äº‹ä»¶çš„äº§ç”Ÿå’Œä¼ é€’"></a>äº‹ä»¶çš„äº§ç”Ÿå’Œä¼ é€’</h5><p>äº‹ä»¶äº§ç”Ÿä¹‹åï¼Œç³»ç»Ÿä¼šå°†æ”¹æ—¶é—´åŠ å…¥åˆ°ä¸€ä¸ªç”±<code>UIApplication</code>ç®¡ç†çš„äº‹ä»¶é˜Ÿåˆ—ä¸­ï¼ˆé˜Ÿåˆ—å…ˆè¿›å…ˆå‡ºï¼‰ã€‚<br><code>UIApplication</code>ä¼šä»äº‹ä»¶é˜Ÿåˆ—ä¸­å–å‡ºæœ€å‰é¢çš„äº‹ä»¶ï¼Œå¹¶å°†äº‹ä»¶åˆ†å‘ä¸‹å»ä»¥ä¾¿å¤„ç†ï¼Œé€šå¸¸ä¼šå…ˆå‘é€åˆ°<code>Window</code>ã€‚</p><h5 id="Event-Handingäº‹ä»¶åˆ†å‘"><a href="#Event-Handingäº‹ä»¶åˆ†å‘" class="headerlink" title="Event Handingäº‹ä»¶åˆ†å‘"></a><code>Event Handing</code>äº‹ä»¶åˆ†å‘</h5><p>ç›¸åº”çš„è·¯çº¿ï¼š<br><code>First Responser -- &gt; The Window -- &gt;The Application -- &gt; App Delegate</code></p><ul><li><code>First Responser</code>æŒ‡çš„æ˜¯å½“å‰æ¥æ”¶äº‹ä»¶çš„å“åº”è€…å¯¹è±¡ï¼Œå³å½“å‰æ­£åœ¨ä¸ç”¨æˆ·è¿›è¡Œäº¤äº’ã€‚äº‹ä»¶åˆ†å‘å°±æ˜¯ä¸ºäº†æ‰¾å‡ºç¬¬ä¸€å“åº”è€…ï¼Œä½¿å…¶æœ‰æœºä¼šé¦–å…ˆå¤„ç†äº‹ä»¶ã€‚å¦‚æœå®ƒæ²¡æœ‰è¿›è¡Œå¤„ç†ï¼Œç³»ç»Ÿå°±ä¼šå°†äº‹ä»¶ä¼ é€’ç»™ä¸‹ä¸€ä¸ªå“åº”è€…ã€‚</li><li>äº‹ä»¶å¦‚æœæ²¡æœ‰å¾—åˆ°å¤„ç†æˆ–è€…æ²¡æœ‰æ‰¾åˆ°ç¬¬ä¸€å“åº”è€…ï¼Œè¯¥äº‹ä»¶å°±ä¼šæ²¿ç€å“åº”é“¾å¾€ä¸Šå›æº¯ï¼Œåˆ°æœ€å<code>UIApplication</code>éƒ½ä¸å¤„ç†å°±ä¸¢å¼ƒäº‹ä»¶ã€‚</li><li>å¦‚æœå½“å‰çš„<code>view</code>æ˜¯æ§åˆ¶å™¨çš„<code>view</code>ï¼Œé‚£ä¹ˆæ§åˆ¶å™¨å°±æ˜¯ä¸Šä¸€ä¸ªå“åº”è€…ï¼›å¦‚æœå½“å‰çš„<code>view</code>ä¸æ˜¯æ§åˆ¶å™¨çš„<code>view</code>ï¼Œé‚£ä¹ˆçˆ¶æ§ä»¶å°±æ˜¯ä¸Šä¸€ä¸ªå“åº”è€…ã€‚</li></ul><h5 id="UIGestureRecognizeræ‰‹åŠ¿è¯†åˆ«å™¨"><a href="#UIGestureRecognizeræ‰‹åŠ¿è¯†åˆ«å™¨" class="headerlink" title="UIGestureRecognizeræ‰‹åŠ¿è¯†åˆ«å™¨"></a><code>UIGestureRecognizer</code>æ‰‹åŠ¿è¯†åˆ«å™¨</h5><p>æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œå®šä¹‰äº†æ‰€æœ‰æ‰‹åŠ¿çš„åŸºæœ¬è¡Œä¸ºï¼Œä½¿ç”¨å®ƒçš„å­ç±»æ‰èƒ½å¤„ç†å…·ä½“çš„æ‰‹åŠ¿ã€‚ä¾¿äºè§¦æ‘¸äº‹ä»¶çš„å¤„ç†ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">UITapGestureRecognizer    //æ•²å‡»</span><br><span class="line">UIPinchGestureRecognizer    //æåˆï¼Œç¼©æ”¾</span><br><span class="line">UIRotationGestureRecognizer    //æ—‹è½¬</span><br><span class="line">UISwipeGestureRecognizer    //è½»æ‰«</span><br><span class="line">UIPanGestureRecognizer    //æ‹–æ‹½</span><br><span class="line">UIScreenEdgePanGestureRecognizer    //å±å¹•è¾¹ç¼˜ä¾§æ»‘</span><br><span class="line">UILongPressGestureRecognizer    //é•¿æŒ‰</span><br></pre></td></tr></table></figure></p><p>å½“æœ‰ä¸¤ä¸ªç›¸å…³è”çš„æ‰‹åŠ¿å­˜åœ¨æ—¶ï¼Œå¯ä»¥ä½¿ç”¨<code>[B requireGestureRecognizerToFail: A]</code>æŒ‡å®šAæ‰‹åŠ¿åœ¨Bæ‰‹åŠ¿ç¡®å®šå¤±è´¥äº†ä¹‹åæ‰è§¦å‘ã€‚</p><h6 id="UITouch"><a href="#UITouch" class="headerlink" title="UITouch"></a><code>UITouch</code></h6><p>å½“ç”¨æˆ·ç”¨ä¸€æ ¹æ‰‹æŒ‡è§¦æ‘¸å±å¹•æ—¶ï¼Œä¼šåˆ›å»ºä¸€ä¸ªä¸æ‰‹æŒ‡ç›¸å…³è”çš„<code>UITouch</code>å¯¹è±¡ã€‚<br>å½“æ‰‹æŒ‡ç§»åŠ¨æ—¶ï¼Œç³»ç»Ÿä¸ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„<code>UITouch</code>å¯¹è±¡ï¼Œè€Œæ˜¯æ›´æ–°å…¶å±æ€§ä½¿ä¹‹èƒ½ä¸€ç›´ä¿å­˜ç€ç›¸å…³çš„ä¿¡æ¯ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">//è¿”å›è§¦æ‘¸çš„ä½ç½®ï¼Œè¯¥ä½ç½®æ˜¯é’ˆå¯¹è§¦æ‘¸çš„ view çš„åæ ‡ç³»ï¼Œå½“ä¼ å…¥å‚æ•°ä¸º nil æ—¶ï¼Œè¿”å›çš„æ˜¯ window çš„ä½ç½®ã€‚</span><br><span class="line">- locationInView:</span><br><span class="line">//è¿”å›å‰ä¸€ä¸ªè§¦æ‘¸ç‚¹çš„ä½ç½®ã€‚</span><br><span class="line">- previousLocationInView:</span><br></pre></td></tr></table></figure></p><h6 id="UIEvent"><a href="#UIEvent" class="headerlink" title="UIEvent"></a><code>UIEvent</code></h6><p>æ¯äº§ç”Ÿä¸€ä¸ªäº‹ä»¶ï¼Œå°±ä¼šäº§ç”Ÿä¸€ä¸ª<code>UIEvent</code>å¯¹è±¡ã€‚å¯ä»¥é€šè¿‡<code>allTouches</code>æ–¹æ³•è·å–å¾—åˆ°è§¦æ‘¸ç‚¹çš„é›†åˆï¼Œå¯ä»¥åˆ¤æ–­å¤šç‚¹è§¦æ‘¸äº‹ä»¶ï¼ˆå•ç‚¹è§¦æ‘¸<code>touches</code>ä¸­åªæœ‰ä¸€ä¸ª<code>UITouch</code>ï¼‰ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h5 id=&quot;å“åº”è€…å¯¹è±¡&quot;&gt;&lt;a href=&quot;#å“åº”è€…å¯¹è±¡&quot; class=&quot;headerlink&quot; title=&quot;å“åº”è€…å¯¹è±¡&quot;&gt;&lt;/a&gt;å“åº”è€…å¯¹è±¡&lt;/h5&gt;&lt;p&gt;æŒ‡å¯ä»¥æ¥æ”¶å¹¶å¤„ç†äº‹ä»¶çš„å¯¹è±¡ã€‚ &lt;code&gt;UIResponder&lt;/code&gt; æ˜¯æ‰€æœ‰å“åº”è€…å¯¹è±¡çš„åŸºç±»ã€‚&lt;/p&gt;
&lt;
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>å•ä¾‹æ¨¡å¼ Singleton</title>
    <link href="http://yoursite.com/2018/05/26/%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F%20%E4%B8%8B%E5%8D%885.42.09/"/>
    <id>http://yoursite.com/2018/05/26/å•ä¾‹æ¨¡å¼ ä¸‹åˆ5.42.09/</id>
    <published>2018-05-26T07:17:22.000Z</published>
    <updated>2018-06-03T08:34:41.000Z</updated>
    
    <content type="html"><![CDATA[<p>å•ä¾‹è®¾è®¡æ¨¡å¼ç¡®ä¿å¯¹äºä¸€ä¸ªç»™å®šçš„ç±»åªæœ‰ä¸€ä¸ªå®ä¾‹å­˜åœ¨ï¼Œè¿™ä¸ªå®ä¾‹æœ‰ä¸€ä¸ªå…¨å±€å”¯ä¸€çš„è®¿é—®ç‚¹ã€‚é€šå¸¸é‡‡ç”¨æ‡’åŠ è½½çš„æ–¹å¼åœ¨ç¬¬ä¸€æ¬¡ç”¨åˆ°å®ä¾‹çš„æ—¶å€™å†å»åˆ›å»ºå®ƒã€‚</p><h5 id="ä½œç”¨"><a href="#ä½œç”¨" class="headerlink" title="ä½œç”¨"></a>ä½œç”¨</h5><p>ä¿è¯åœ¨ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­ï¼Œä¸€ä¸ªç±»åªæœ‰ä¸€ä¸ªå®ä¾‹ä¸”æ˜“äºå¤–ç•Œè®¿é—®ï¼Œä»è€Œæ–¹ä¾¿åœ°æ§åˆ¶äº†å®ä¾‹ä¸ªæ•°ï¼Œå¹¶èŠ‚çº¦ç³»ç»Ÿèµ„æº</p><h5 id="ä½¿ç”¨åœºåˆ"><a href="#ä½¿ç”¨åœºåˆ" class="headerlink" title="ä½¿ç”¨åœºåˆ"></a>ä½¿ç”¨åœºåˆ</h5><p>ç»Ÿä¸€ç®¡ç†èµ„æºæˆ–å…±äº«ä¸€ä»½èµ„æºã€‚æ¯”å¦‚ï¼Œç™»å½•æ§åˆ¶å™¨ï¼Œç½‘ç»œæ•°æ®è¯·æ±‚ç­‰ã€‚</p><h5 id="ä¼˜ç¼ºç‚¹"><a href="#ä¼˜ç¼ºç‚¹" class="headerlink" title="ä¼˜ç¼ºç‚¹"></a>ä¼˜ç¼ºç‚¹</h5><h6 id="ä¼˜ç‚¹"><a href="#ä¼˜ç‚¹" class="headerlink" title="ä¼˜ç‚¹"></a>ä¼˜ç‚¹</h6><ol><li>ä¿è¯åœ¨ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­ï¼Œä¸€ä¸ªç±»åªæœ‰ä¸€ä¸ªå®ä¾‹ä¸”æ˜“äºå¤–ç•Œè®¿é—®ï¼Œä»è€Œæ–¹ä¾¿åœ°æ§åˆ¶äº†å®ä¾‹ä¸ªæ•°ï¼Œå¹¶èŠ‚çº¦ç³»ç»Ÿèµ„æºã€‚</li><li>ç±»æ§åˆ¶äº†å®ä¾‹åŒ–è¿‡ç¨‹ï¼Œæ‰€ä»¥ç±»å¯ä»¥æ›´åŠ çµæ´»ä¿®æ”¹å®ä¾‹åŒ–è¿‡ç¨‹ã€‚<h6 id="ç¼ºç‚¹"><a href="#ç¼ºç‚¹" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h6></li><li>å•ä¾‹å¯¹è±¡ä¸€æ—¦å»ºç«‹ï¼Œå¯¹è±¡æŒ‡é’ˆæ˜¯åœ¨ä¿å­˜åœ¨é™æ€åŒºçš„ï¼Œå•ä¾‹å¯¹è±¡åœ¨å †ä¸­åˆ†é…çš„å†…å­˜ç©ºé—´ï¼Œä¼šåœ¨åº”ç”¨ç¨‹åºç»ˆæ­¢ä¹‹åæ‰ä¼šè¢«é‡Šæ”¾ã€‚</li><li>ä¸ä½¿ç”¨äºå˜åŒ–çš„å¯¹è±¡ï¼Œå¦‚æœåŒä¸€ç±»å‹çš„å¯¹è±¡æ€»æ˜¯è¦åœ¨ä¸åŒçš„ç”¨ä¾‹åœºæ™¯ä¸­å‘ç”Ÿå˜åŒ–ï¼Œå•ä¾‹å°±ä¼šå¼•èµ·æ•°æ®çš„é”™è¯¯ï¼Œä¸èƒ½ä¿å­˜å½¼æ­¤çš„çŠ¶æ€ã€‚</li><li>å•ä¾‹ç±»æ— æ³•ç»§æ‰¿ï¼Œå› æ­¤å¾ˆéš¾è¿›è¡Œç±»çš„æ‰©å±•</li></ol><h5 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h5><ol><li>åªæœ‰ä¸€ä¸ªå®ä¾‹å­˜åœ¨<code>static</code></li><li>åªåˆ†é…ä¸€æ¬¡å†…å­˜ <code>alloc</code></li><li>è€ƒè™‘çº¿ç¨‹å®‰å…¨</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">+ (LocationManager *)sharedLocationManager;</span><br><span class="line"></span><br><span class="line">static LocationManager *_shareLocationManager;</span><br><span class="line">+ (instancetype)allocWithZone:(struct _NSZone *)zone &#123;   </span><br><span class="line">    //é¿å…æ¯æ¬¡çº¿ç¨‹è¿‡æ¥éƒ½åŠ é”ï¼Œå…ˆåˆ¤æ–­ä¸€æ¬¡ï¼Œå¦‚æœä¸ºç©ºæ‰ä¼šç»§ç»­åŠ é”å¹¶åˆ›å»ºå¯¹è±¡</span><br><span class="line">    if(_shareLocationManager == nil) &#123;</span><br><span class="line">        //é¿å…å‡ºç°å¤šä¸ªçº¿ç¨‹åŒæ—¶åˆ›å»º_instance,åŠ é”</span><br><span class="line">        @synchronized(self) &#123;   </span><br><span class="line">            //ä½¿ç”¨æ‡’åŠ è½½ï¼Œç¡®ä¿_instance åªåˆ›å»ºä¸€æ¬¡</span><br><span class="line">            if(_shareLocationManager == nil) &#123;   </span><br><span class="line">                _shareLocationManager = [super allocWithZone:zone];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;  </span><br><span class="line"></span><br><span class="line">    return _shareLocationManager;   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>æ¯æ¬¡è·å–å®ä¾‹éƒ½ä¼šè¿›è¡Œåˆ¤æ–­æ˜¯å¦éœ€è¦åˆ›å»ºå®ä¾‹ã€‚</li><li>ä¸åŠ åŒæ­¥é”æ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ï¼Œæ¯”å¦‚ï¼Œæœ‰ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶è·å–å®ä¾‹ï¼ŒAåœ¨åˆ›å»ºå®ä¾‹ä¸­è¿˜æ²¡æœ‰åˆ›å»ºå®Œæˆï¼ŒBé€šè¿‡åˆ¤æ–­ä¹Ÿè¿›è¡Œåˆ›å»ºï¼Œå•ä¾‹çš„æ§åˆ¶å°±ä¼šåœ¨å¹¶å‘çš„æƒ…å†µä¸‹å¤±æ•ˆã€‚</li><li>åŠ é”å®¹æ˜“å¼•èµ·æ•ˆç‡é™ä½ï¼Œåœ¨åŠ é”ä¹‹å‰å…ˆè¿›è¡Œåˆ¤æ–­ï¼Œå½“éœ€è¦åˆ›å»ºå¯¹è±¡æ—¶å†åŠ é”</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">+ (LocationManager *)sharedLocationManager;</span><br><span class="line"></span><br><span class="line">static LocationManager *_shareLocationManager;</span><br><span class="line">+ (instancetype)allocWithZone:(struct _NSZone *)zone &#123;   </span><br><span class="line">    static dispatch_once_t onceToken;   </span><br><span class="line">    dispatch_once(&amp;onceToken, ^&#123;   </span><br><span class="line">        _shareLocationManager = [super allocWithZone:zone];   </span><br><span class="line">    &#125;);  </span><br><span class="line"> </span><br><span class="line">    return _shareLocationManager;   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>å£°æ˜ä¸€ä¸ªé™æ€å˜é‡å»ä¿å­˜ç±»çš„å®ä¾‹ï¼Œç¡®ä¿å®ƒåœ¨ç±»ä¸­çš„å…¨å±€å¯ç”¨æ€§ã€‚</li><li>å£°æ˜ä¸€ä¸ªé™æ€å˜é‡ <code>dispatch_once_t</code>ï¼Œå®ƒç¡®ä¿åˆå§‹åŒ–ä»£ç åªæ‰§è¡Œä¸€æ¬¡ã€‚</li><li>ä½¿ç”¨<code>dispatch_once</code>æ‰§è¡Œåˆå§‹åŒ–çš„<code>blokc</code>ï¼Œä¸€æ—¦ç±»å·²ç»è¢«åˆå§‹åŒ–ï¼Œåˆå§‹åŒ–å™¨å°†æ°¸è¿œä¸ä¼šå†è¢«è°ƒç”¨ã€‚</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">+ (LocationManager *)sharedLocationManager &#123;</span><br><span class="line">    return [[self alloc]init];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (id)copyWithZone:(NSZone *)zone &#123;   </span><br><span class="line">    return _shareLocationManager;   </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (id)mutableCopyWithZone:(NSZone *)zone &#123;   </span><br><span class="line">    return _shareLocationManager;   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“è°ƒç”¨<code>sharedLocationManager `</code>alloc<code></code>copy`çš„æ—¶å€™ï¼Œå°†å¾—åˆ°çš„å®ä¾‹éƒ½æ˜¯ä¸€æ ·çš„ã€‚</p><h6 id="static"><a href="#static" class="headerlink" title="static"></a><code>static</code></h6><ol><li>ä¿®é¥°å±€éƒ¨å˜é‡<br>ä¿è¯å±€éƒ¨å˜é‡æ°¸è¿œåªåˆå§‹åŒ–ä¸€æ¬¡ï¼Œåœ¨ç¨‹åºçš„è¿è¡Œè¿‡ç¨‹ä¸­æ°¸è¿œåªæœ‰ä¸€ä»½å†…å­˜ï¼Œç”Ÿå‘½å‘¨æœŸç±»ä¼¼å…¨å±€å˜é‡ï¼Œä½†æ˜¯ä½œç”¨åŸŸä¸å˜ã€‚</li><li>ä¿®é¥°å…¨å±€å˜é‡<br>ä½¿å¾—å…¨å±€å˜é‡çš„ä½œç”¨åŸŸä»…é™äºå½“å‰çš„æ–‡ä»¶å†…éƒ¨ï¼Œå³åªæœ‰å½“å‰æ–‡ä»¶å†…éƒ¨æ‰èƒ½è®¿é—®è¯¥å…¨å±€å˜é‡ã€‚</li><li>é»˜è®¤åˆå§‹åŒ–ä¸º0<br>åœ¨é™æ€æ•°æ®åŒºï¼Œå†…å­˜ä¸­çš„æ‰€æœ‰å­—èŠ‚é»˜è®¤å€¼éƒ½æ˜¯<code>0x00</code>ã€‚</li><li>ä¿®é¥°å‡½æ•°<br>è¢«ä¿®é¥°çš„å‡½æ•°è¢«ç§°ä¸ºé™æ€å‡½æ•°ã€‚</li></ol><h6 id="alloc"><a href="#alloc" class="headerlink" title="alloc"></a><code>alloc</code></h6><ol><li><code>alloc</code>è°ƒç”¨äº†<code>allocWithZone:</code>ï¼Œåœ¨ç³»ç»Ÿä¸­åˆ†é…å†…å­˜å¹¶è¿”å›è¿™æ®µå†…å­˜çš„æŒ‡é’ˆã€‚</li><li><code>alloc</code>åªæ‰§è¡Œä¸€æ¬¡ã€‚è€Œ<code>init</code>ä¼šä»ç»§æ‰¿é“¾çš„é¡¶éƒ¨å¼€å§‹æ‰§è¡Œï¼Œå› ä¸ºéœ€è¦å…ˆåˆå§‹åŒ–<code>[super init]</code>ï¼Œæ‰€ä»¥ä¼šè‡ªä¸Šè€Œä¸‹æ‰§è¡Œå¤šæ¬¡ã€‚</li><li>å°†ç”³è¯·ç©ºé—´ä¸­çš„å€¼éƒ½è®¾ç½®ä¸º0ã€‚</li></ol><h6 id="çº¿ç¨‹å®‰å…¨"><a href="#çº¿ç¨‹å®‰å…¨" class="headerlink" title="çº¿ç¨‹å®‰å…¨"></a>çº¿ç¨‹å®‰å…¨</h6><ol><li>æŒ‡æŸä¸ªå‡½æ•°åœ¨ã€å‡½æ•°åº“åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­è¢«è°ƒç”¨æ—¶ï¼Œèƒ½æ­£ç¡®åœ°å¤„ç†å¤šä¸ªçº¿ç¨‹ä¹‹é—´çš„å…±äº«å˜é‡ï¼Œä½¿å¾—ç¨‹åºåŠŸèƒ½èƒ½æ­£ç¡®å®Œæˆã€‚</li><li>çº¿ç¨‹å®‰å…¨æ˜¯ç›¸å¯¹äºå¤šçº¿ç¨‹è€Œè¨€çš„ï¼Œå•çº¿ç¨‹ä¸‹ä¸ä¼šå­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œå› ä¸ºå•çº¿ç¨‹ä¸‹çš„æ‰§è¡Œé¡ºåºæ˜¯ç¡®å®šçš„ã€‚</li></ol>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;å•ä¾‹è®¾è®¡æ¨¡å¼ç¡®ä¿å¯¹äºä¸€ä¸ªç»™å®šçš„ç±»åªæœ‰ä¸€ä¸ªå®ä¾‹å­˜åœ¨ï¼Œè¿™ä¸ªå®ä¾‹æœ‰ä¸€ä¸ªå…¨å±€å”¯ä¸€çš„è®¿é—®ç‚¹ã€‚é€šå¸¸é‡‡ç”¨æ‡’åŠ è½½çš„æ–¹å¼åœ¨ç¬¬ä¸€æ¬¡ç”¨åˆ°å®ä¾‹çš„æ—¶å€™å†å»åˆ›å»ºå®ƒã€‚&lt;/p&gt;
&lt;h5 id=&quot;ä½œç”¨&quot;&gt;&lt;a href=&quot;#ä½œç”¨&quot; class=&quot;headerlink&quot; title=&quot;ä½œç”¨&quot;&gt;&lt;/a&gt;ä½œç”¨&lt;/
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>Hello World</title>
    <link href="http://yoursite.com/2018/05/12/hello-world/"/>
    <id>http://yoursite.com/2018/05/12/hello-world/</id>
    <published>2018-05-12T05:20:53.000Z</published>
    <updated>2018-05-12T06:23:31.000Z</updated>
    
    <content type="html"><![CDATA[<p>hi~</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;hi~&lt;/p&gt;

      
    
    </summary>
    
    
  </entry>
  
</feed>
